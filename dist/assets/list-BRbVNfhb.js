import{i as M}from"./constants-BXcKDdXi.js";import{r,o as Z,c as u,a as i,w as e,b as l,d as t,t as c,e as X,f,h as B,F as ee,j as le,C as fe,g as d,u as s,V as R,s as _e,x as ve,k as G,i as S,l as N}from"./index-CTHS9Uo5.js";import{_ as te}from"./DialogCloseBtn-CmFX9Z5g.js";import{V as H}from"./VCard-DCSOa-uS.js";import{V as J}from"./VCardText-DvHr5E0T.js";import{V as ae}from"./VForm-DutAvWyc.js";import{V as O,a as _}from"./VRow-BhAPnYDA.js";import{V as oe}from"./VTable-2kho1lTo.js";import{V as Ve}from"./VAvatar-B74PEF1E.js";import{V as ge}from"./VImg-DbUZi3rZ.js";import{V as E}from"./VChip-C2kZ6mQo.js";import{V as I}from"./VAlert-DEc64QkE.js";import{V as se}from"./VDialog-BCy7d4kf.js";import{$ as ne}from"./api-DV6oDQ6t.js";import{_ as ye}from"./IconBtn-DXVljAVB.js";import{_ as be}from"./AppDateTimePicker-BCLx0bW5.js";import{V as Q}from"./VTextField-ZaB3RHnj.js";import{V as L}from"./VSelect-I2Djs2tK.js";import{V as Y}from"./VTooltip-BiRPOg8i.js";import{V as he}from"./VPagination-3n6UBKF_.js";import"./forwardRefs-DWGaNmQL.js";/* empty css              */import"./VOverlay-CQPilPWj.js";import"./index-BYrzgnBV.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VList-BeeB6M1u.js";import"./VDivider-D7LS911x.js";import"./VMenu-B-CF11VB.js";import"./VCheckboxBtn-Mk3d90yG.js";const xe={class:"text-center pb-6"},Ce={class:"text-h4 mb-2"},ke=t("thead",null,[t("tr",null,[t("th",{class:"text-uppercase"}," Producto "),t("th",{class:"text-uppercase"}," E. Entrega "),t("th",{class:"text-uppercase"}," Unidad "),t("th",{class:"text-uppercase"}," Cantidad "),t("th",{class:"text-uppercase"}," Total ")])],-1),we={class:"d-flex align-center"},De={class:"d-flex ms-3"},Se={style:{"text-wrap-mode":"nowrap"}},$e={__name:"SaleDetailShowDialog",props:{isDialogVisible:{type:Boolean,required:!0},saleSelected:{type:Object,required:!0}},emits:["update:isDialogVisible"],setup(F,{emit:T}){const V=F,g=T;r(null),r(null),r(null);const b=r(null),$=r(null),h=r(null),x=()=>{g("update:isDialogVisible",!1),g("submit",userData.value)},y=()=>{g("update:isDialogVisible",!1)},C=p=>{g("update:isDialogVisible",p)};return Z(()=>{}),(p,k)=>{const w=te;return i(),u(se,{"max-width":"850","model-value":V.isDialogVisible,"onUpdate:modelValue":C},{default:e(()=>[l(H,{class:"pa-sm-11 pa-3"},{default:e(()=>[l(w,{variant:"text",size:"default",onClick:y}),l(J,{class:"pt-5"},{default:e(()=>[t("div",xe,[t("h4",Ce," Detallado de la Venta : "+c(V.saleSelected.id),1)]),l(ae,{class:"mt-4",onSubmit:X(x,["prevent"])},{default:e(()=>[l(O,null,{default:e(()=>[l(_,{cols:"12"},{default:e(()=>[l(oe,null,{default:e(()=>[ke,t("tbody",null,[(i(!0),B(ee,null,le(V.saleSelected.sale_details,m=>(i(),B("tr",{key:m.id},[t("td",null,[t("div",we,[l(Ve,{size:"32",color:m.product.imagen?"":"primary",class:fe(m.product.imagen?"":"v-avatar-light-bg primary--text"),variant:m.product.imagen?void 0:"tonal"},{default:e(()=>[l(ge,{src:m.product.imagen},null,8,["src"])]),_:2},1032,["color","class","variant"]),t("div",De,c(m.product.title),1)])]),t("td",null,[m.state_attention==1?(i(),u(E,{key:0,color:"error"},{default:e(()=>[d(" Pendiente ")]),_:1})):f("",!0),m.state_attention==2?(i(),u(E,{key:1,color:"warning"},{default:e(()=>[d(" Parcial ")]),_:1})):f("",!0),m.state_attention==3?(i(),u(E,{key:2,color:"primary"},{default:e(()=>[d(" Completo ")]),_:1})):f("",!0)]),t("td",null,c(m.unit.name),1),t("td",null,c(m.quantity),1),t("td",Se," â‚¬ "+c(m.total),1)]))),128))])]),_:1})]),_:1}),s(b)?(i(),u(_,{key:0,cols:"12"},{default:e(()=>[l(I,{closable:"","close-label":"Close Alert",color:"warning"},{default:e(()=>[d(c(s(b)),1)]),_:1})]),_:1})):f("",!0),s($)?(i(),u(_,{key:1,cols:"12"},{default:e(()=>[l(I,{closable:"","close-label":"Close Alert",color:"error"},{default:e(()=>[d(c(s($)),1)]),_:1})]),_:1})):f("",!0),s(h)?(i(),u(_,{key:2,cols:"12"},{default:e(()=>[l(I,{closable:"","close-label":"Close Alert",color:"success"},{default:e(()=>[d(c(s(h)),1)]),_:1})]),_:1})):f("",!0),l(_,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:e(()=>[l(R,{color:"secondary",variant:"outlined",onClick:y},{default:e(()=>[d(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Ee={class:"text-center pb-6"},Pe={class:"text-h4 mb-2"},Ue={__name:"SaleDeleteDialog",props:{isDialogVisible:{type:Boolean,required:!0},saleSelected:{type:Object,required:!0}},emits:["update:isDialogVisible","deleteSale"],setup(F,{emit:T}){const V=F,g=T,b=r(null),$=r(null),h=r(null),x=async()=>{b.value=null,$.value=null,h.value=null;try{const p=await ne("sales/"+V.saleSelected.id,{method:"DELETE",onResponseError({response:k}){$.value=k._data.error}});console.log(p),g("deleteSale",V.saleSelected),y()}catch(p){console.log(p)}};Z(()=>{console.log(V.saleSelected)});const y=()=>{g("update:isDialogVisible",!1)},C=p=>{g("update:isDialogVisible",p)};return(p,k)=>{const w=te;return i(),u(se,{"max-width":"650","model-value":V.isDialogVisible,"onUpdate:modelValue":C},{default:e(()=>[l(H,{class:"pa-sm-11 pa-3"},{default:e(()=>[l(w,{variant:"text",size:"default",onClick:y}),l(J,{class:"pt-5"},{default:e(()=>[t("div",Ee,[t("h4",Pe," Delete Sale : "+c(V.saleSelected.id),1)]),l(ae,{class:"mt-4",onSubmit:X(x,["prevent"])},{default:e(()=>[l(O,null,{default:e(()=>[l(_,{cols:"12"},{default:e(()=>[t("p",null,"Â¿Estas seguro de eliminar esta venta : #"+c(V.saleSelected.id)+"?",1)]),_:1}),s(b)?(i(),u(_,{key:0,cols:"12"},{default:e(()=>[l(I,{closable:"","close-label":"Close Alert",color:"warning"},{default:e(()=>[d(c(s(b)),1)]),_:1})]),_:1})):f("",!0),s($)?(i(),u(_,{key:1,cols:"12"},{default:e(()=>[l(I,{closable:"","close-label":"Close Alert",color:"error"},{default:e(()=>[d(c(s($)),1)]),_:1})]),_:1})):f("",!0),s(h)?(i(),u(_,{key:2,cols:"12"},{default:e(()=>[l(I,{closable:"","close-label":"Close Alert",color:"success"},{default:e(()=>[d(c(s(h)),1)]),_:1})]),_:1})):f("",!0),l(_,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:e(()=>[l(R,{type:"submit",color:"error"},{default:e(()=>[d(" Eliminar ")]),_:1}),l(R,{color:"secondary",variant:"outlined",onClick:y},{default:e(()=>[d(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Ae={class:"d-flex mt-5"},Re=t("thead",null,[t("tr",null,[t("th",{class:"text-uppercase"},"NÂ°"),t("th",{class:"text-uppercase"},"Cliente"),t("th",{class:"text-uppercase"},"Tipo cliente"),t("th",{class:"text-uppercase"},"Asesor"),t("th",{class:"text-uppercase"},"Total"),t("th",{class:"text-uppercase"},"Deuda/Pagado"),t("th",{class:"text-uppercase"},"Tipo"),t("th",{class:"text-uppercase"},"E. de pago"),t("th",{class:"text-uppercase"},"E. de entrega"),t("th",{class:"text-uppercase"},"F. de registro"),t("th",{class:"text-uppercase"},"Acciones")])],-1),Te={style:{"text-wrap-mode":"nowrap"}},Ie={style:{"text-wrap-mode":"nowrap"}},ze={style:{"text-wrap-mode":"nowrap"}},Ne={style:{"text-wrap-mode":"nowrap"}},Be={style:{"text-wrap-mode":"nowrap"}},Fe={style:{"text-wrap-mode":"nowrap"}},Le={class:"d-flex gap-1"},vl={__name:"list",setup(F){const T=_e(),V=r(!1),g=r(!1),b=r(1),$=r(0),h=r([]),x=r(null),y=r(null),C=r(null),p=r(null),k=r(null),w=r(null),m=r(null),P=r(null),j=r(null),q=r(null),W="https://api-ciscarerp.duckdns.org/api",U=async()=>{try{const n={search:x.value,type_client:y.value,search_client:C.value,start_date:p.value?p.value.split("to")[0]:"",end_date:p.value?p.value.split("to")[1]:"",type:k.value,state_entrega:w.value,state_payment:m.value,search_product:P.value},a=await ne("sales/index?page="+b.value,{method:"POST",body:n,onResponseError({response:D}){var v;console.log(((v=D._data)==null?void 0:v.error)||"Error listando ventas")}});h.value=a.sales.data,$.value=a.total_page}catch(n){console.log(n)}};ve(b,()=>{U()});const ie=()=>{x.value="",y.value="",C.value="",p.value="",k.value="",w.value="",m.value="",P.value="",b.value=1,U()},re=async()=>{let n="";if(x.value&&(n+=`&search=${encodeURIComponent(x.value)}`),y.value&&(n+=`&type_client=${y.value}`),C.value&&(n+=`&search_client=${encodeURIComponent(C.value)}`),p.value){const[a,D]=p.value.split("to");n+=`&start_date=${encodeURIComponent(a)}&end_date=${encodeURIComponent(D)}`}k.value&&(n+=`&type=${k.value}`),w.value&&(n+=`&state_entrega=${w.value}`),m.value&&(n+=`&state_payment=${m.value}`),P.value&&(n+=`&search_product=${encodeURIComponent(P.value)}`);try{const a=localStorage.getItem("token")||"",D=`${W}/sales-excel?z=1${n}`,v=await fetch(D,{method:"GET",headers:{Authorization:`Bearer ${a}`,Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}});if(!v.ok){console.error("No se pudo obtener el Excel:",v.status,await v.text());return}const z=await v.blob(),A=document.createElement("a");A.href=URL.createObjectURL(z),A.download="reporte_ventas_cotizacion.xlsx",document.body.appendChild(A),A.click(),A.remove()}catch(a){console.error("Error descargando Excel",a)}},ue=n=>{T.push({name:"sales-edit-id",params:{id:n.id}})},de=n=>{V.value=!0,j.value=n},ce=n=>{const a=h.value.findIndex(D=>D.id==n.id);a!==-1&&h.value.splice(a,1)},pe=n=>{g.value=!0,q.value=n},me=async n=>{try{const a=localStorage.getItem("token")||"",D=`${W}/sales-pdf/${n.id}`,v=await fetch(D,{method:"GET",headers:{Authorization:`Bearer ${a}`,Accept:"application/pdf"}});if(!v.ok){console.error("No se pudo obtener el PDF:",v.status,await v.text());return}const z=await v.blob();window.open(URL.createObjectURL(z),"_blank")}catch(a){console.error("Error descargando PDF",a)}};return Z(()=>{U()}),(n,a)=>{const D=be,v=ye,z=Ue,A=$e;return i(),B("div",null,[l(H,{title:"ðŸ›ï¸  Ventas/CotizaciÃ³n"},{default:e(()=>[l(J,null,{default:e(()=>[l(O,{class:""},{default:e(()=>[l(_,{cols:"10"},{default:e(()=>[l(O,null,{default:e(()=>[l(_,{cols:"3"},{default:e(()=>[l(Q,{label:"NÂ° Venta/CotizaciÃ³n",placeholder:"NÂ°",class:"me-3",modelValue:s(x),"onUpdate:modelValue":a[0]||(a[0]=o=>S(x)?x.value=o:null),onKeyup:G(U,["enter"])},null,8,["modelValue"])]),_:1}),l(_,{cols:"3"},{default:e(()=>[l(L,{placeholder:"Select",label:"Tipo de cliente",items:[{id:1,title:"Cliente Final"},{id:2,title:"Cliente Empresa"}],"item-title":"title","item-value":"id",modelValue:s(y),"onUpdate:modelValue":a[1]||(a[1]=o=>S(y)?y.value=o:null)},null,8,["modelValue"])]),_:1}),l(_,{cols:"3"},{default:e(()=>[l(Q,{label:"Cliente",placeholder:"Search",class:"me-3",modelValue:s(C),"onUpdate:modelValue":a[2]||(a[2]=o=>S(C)?C.value=o:null),onKeyup:G(U,["enter"])},null,8,["modelValue"])]),_:1}),l(_,{cols:"3"},{default:e(()=>[l(D,{modelValue:s(p),"onUpdate:modelValue":a[3]||(a[3]=o=>S(p)?p.value=o:null),label:"Rango de fecha",placeholder:"Select date",config:{mode:"range"}},null,8,["modelValue"])]),_:1}),l(_,{cols:"2"},{default:e(()=>[l(L,{placeholder:"Select",label:"Tipo",items:[{id:1,title:"Venta"},{id:2,title:"CotizaciÃ³n"}],"item-title":"title","item-value":"id",modelValue:s(k),"onUpdate:modelValue":a[4]||(a[4]=o=>S(k)?k.value=o:null)},null,8,["modelValue"])]),_:1}),l(_,{cols:"3"},{default:e(()=>[l(L,{placeholder:"Select",label:"Estado de entrega",items:[{id:1,title:"Pendiente"},{id:2,title:"Parcial"},{id:3,title:"Completo"}],"item-title":"title","item-value":"id",modelValue:s(w),"onUpdate:modelValue":a[5]||(a[5]=o=>S(w)?w.value=o:null)},null,8,["modelValue"])]),_:1}),l(_,{cols:"3"},{default:e(()=>[l(L,{placeholder:"Select",label:"Estado de pago",items:[{id:1,title:"Pendiente"},{id:2,title:"Parcial"},{id:3,title:"Completo"}],"item-title":"title","item-value":"id",modelValue:s(m),"onUpdate:modelValue":a[6]||(a[6]=o=>S(m)?m.value=o:null)},null,8,["modelValue"])]),_:1}),l(_,{cols:"4"},{default:e(()=>[l(Q,{label:"Producto",placeholder:"Search",class:"me-3",modelValue:s(P),"onUpdate:modelValue":a[7]||(a[7]=o=>S(P)?P.value=o:null),onKeyup:G(U,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(_,{cols:"2",class:"text-end"},{default:e(()=>[("isPermission"in n?n.isPermission:s(M))("register_sale")?(i(),u(R,{key:0,onClick:a[8]||(a[8]=o=>s(T).push({name:"sales-add"}))},{default:e(()=>[d(" AÃ±adir Venta "),l(N,{end:"",icon:"ri-add-line"})]),_:1})):f("",!0),t("div",Ae,[l(R,{color:"info",class:"mx-1","prepend-icon":"ri-search-2-line",onClick:a[9]||(a[9]=o=>U())},{default:e(()=>[l(Y,{activator:"parent",location:"top"},{default:e(()=>[d("Buscar")]),_:1})]),_:1}),l(R,{color:"secondary",class:"mx-1","prepend-icon":"ri-restart-line",onClick:a[10]||(a[10]=o=>ie())},{default:e(()=>[l(Y,{activator:"parent",location:"top"},{default:e(()=>[d("Limpieza")]),_:1})]),_:1}),l(R,{color:"success",class:"mx-1","prepend-icon":"ri-file-excel-2-line",onClick:a[11]||(a[11]=o=>re())},{default:e(()=>[l(Y,{activator:"parent",location:"top"},{default:e(()=>[d("Exportar Ventas/Cotizaciones")]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}),l(oe,null,{default:e(()=>[Re,t("tbody",null,[(i(!0),B(ee,null,le(s(h),o=>(i(),B("tr",{key:o.id,style:{"font-size":"smaller"}},[t("td",null,c(o.id),1),t("td",Te,c(o.client.full_name),1),t("td",Ie,c(o.type_client==1?"CLIENTE FINAL":"CLIENTE EMPRESA"),1),t("td",ze,c(o.user.full_name),1),t("td",Ne,"â‚¬ "+c(o.total),1),t("td",Be,"â‚¬ "+c(o.debt)+" / â‚¬ "+c(o.paid_out),1),t("td",null,c(o.state_sale==1?"VENTA":"COTIZACIÃ“N"),1),t("td",null,[o.state_payment==1?(i(),u(E,{key:0,color:"error"},{default:e(()=>[d("Pendiente")]),_:1})):f("",!0),o.state_payment==2?(i(),u(E,{key:1,color:"warning"},{default:e(()=>[d("Parcial")]),_:1})):f("",!0),o.state_payment==3?(i(),u(E,{key:2,color:"primary"},{default:e(()=>[d("Completo")]),_:1})):f("",!0)]),t("td",null,[o.state_entrega==1?(i(),u(E,{key:0,color:"warning","prepend-icon":"ri-error-warning-line"},{default:e(()=>[d("Pendiente")]),_:1})):f("",!0),o.state_entrega==2?(i(),u(E,{key:1,color:"secondary","prepend-icon":"ri-error-warning-line"},{default:e(()=>[d("Parcial")]),_:1})):f("",!0),o.state_entrega==3?(i(),u(E,{key:2,color:"info","prepend-icon":"ri-star-line"},{default:e(()=>[d("Completo")]),_:1})):f("",!0)]),t("td",Fe,c(o.created_at),1),t("td",null,[t("div",Le,[l(v,{size:"small",onClick:K=>me(o)},{default:e(()=>[l(N,{icon:"ri-file-pdf-2-line"})]),_:2},1032,["onClick"]),l(v,{size:"small",onClick:K=>pe(o)},{default:e(()=>[l(N,{icon:"ri-file-list-2-line"})]),_:2},1032,["onClick"]),("isPermission"in n?n.isPermission:s(M))("edit_sale")?(i(),u(v,{key:0,size:"small",onClick:K=>ue(o)},{default:e(()=>[l(N,{icon:"ri-pencil-line"})]),_:2},1032,["onClick"])):f("",!0),("isPermission"in n?n.isPermission:s(M))("delete_sale")?(i(),u(v,{key:1,size:"small",onClick:K=>de(o)},{default:e(()=>[l(N,{icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])):f("",!0)])])]))),128))])]),_:1}),l(he,{modelValue:s(b),"onUpdate:modelValue":a[12]||(a[12]=o=>S(b)?b.value=o:null),length:s($)},null,8,["modelValue","length"])]),_:1}),s(j)&&s(V)?(i(),u(z,{key:0,isDialogVisible:s(V),"onUpdate:isDialogVisible":a[13]||(a[13]=o=>S(V)?V.value=o:null),saleSelected:s(j),onDeleteSale:ce},null,8,["isDialogVisible","saleSelected"])):f("",!0),s(q)&&s(g)?(i(),u(A,{key:1,isDialogVisible:s(g),"onUpdate:isDialogVisible":a[14]||(a[14]=o=>S(g)?g.value=o:null),saleSelected:s(q)},null,8,["isDialogVisible","saleSelected"])):f("",!0)])}}};export{vl as default};
