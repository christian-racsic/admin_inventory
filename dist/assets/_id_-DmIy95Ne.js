import{_ as Ce}from"./DialogCloseBtn-Cpwqmvb9.js";import{r as n,o as fe,c as m,a as c,w as l,b as e,d as s,t as r,e as he,f as y,u as t,g as b,V as B,i as E,q as rl,x as me,h as _e,k as cl,l as ae,F as Le,j as Be}from"./index-W4kja-31.js";import{$ as J}from"./api-DxrbhZSf.js";import{V as ee}from"./VCard-CrSgQsdG.js";import{V as oe}from"./VCardText-D-w9kZpv.js";import{V as Te}from"./VForm-D3Vuhlg_.js";import{V as L,a as i}from"./VRow-f7OHVuKd.js";import{V as R}from"./VAlert-ELbKA5bW.js";import{V as xe}from"./VDialog-CqxdfU_E.js";import{V as ve}from"./VSelect-CLTqdzaG.js";import{V as le}from"./VTextField-DIHLaahk.js";import{V as ze}from"./VTextarea-DO_zl4Eg.js";import{_ as pl,a as ml}from"./ClientFinalAddDialog-DhmZy1KO.js";import{_ as _l,a as vl}from"./CustomRadiosWithIcon-BffRfhaK.js";import{_ as fl}from"./IconBtn-BnO4JjSS.js";import{_ as yl}from"./AppDateTimePicker-BFxRjtXb.js";import{V as bl}from"./VAutocomplete-CwHZXTr4.js";import{V as gl}from"./VCheckbox-D0DXs1MP.js";import{V as je}from"./VTable-Cddsam7K.js";import{V as Ae}from"./VChip-6YKG-Q6j.js";import"./index-BYrzgnBV.js";import"./VAvatar-D-KF6a6N.js";import"./VImg-BXz4PYAy.js";import"./forwardRefs-DWGaNmQL.js";/* empty css              */import"./VOverlay-DsWRzxlS.js";import"./VList-DFWg69W8.js";import"./VDivider-D7rU52Ox.js";import"./VMenu-HxKMt7sI.js";import"./VCheckboxBtn-D15mcKdF.js";import"./VRadioGroup-Cu5aylT1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./filter-CbKp_48J.js";const Dl={class:"text-center pb-6"},Vl={class:"text-h4 mb-2"},El={__name:"PaymentDeleteDialog",props:{isDialogVisible:{type:Boolean,required:!0},paymentSelected:{type:Object,required:!0}},emits:["update:isDialogVisible","deletePayment"],setup(te,{emit:$}){const d=te,k=$,V=n(null),D=n(null),g=n(null),h=async()=>{V.value=null,D.value=null,g.value=null;try{const _=await J("sale_payments/"+d.paymentSelected.id,{method:"DELETE",onResponseError({response:A}){D.value=A._data.error}});console.log(_),k("deletePayment",_),w()}catch(_){console.log(_)}};fe(()=>{console.log(d.paymentSelected)});const w=()=>{k("update:isDialogVisible",!1)},O=_=>{k("update:isDialogVisible",_)};return(_,A)=>{const x=Ce;return c(),m(xe,{"max-width":"650","model-value":d.isDialogVisible,"onUpdate:modelValue":O},{default:l(()=>[e(ee,{class:"pa-sm-11 pa-3"},{default:l(()=>[e(x,{variant:"text",size:"default",onClick:w}),e(oe,{class:"pt-5"},{default:l(()=>[s("div",Dl,[s("h4",Vl," Delete Payment : "+r(d.paymentSelected.id),1)]),e(Te,{class:"mt-4",onSubmit:he(h,["prevent"])},{default:l(()=>[e(L,null,{default:l(()=>[e(i,{cols:"12"},{default:l(()=>[s("p",null,"Â¿Estas seguro de eliminar el Pago : "+r(d.paymentSelected.method_payment)+"?",1)]),_:1}),t(V)?(c(),m(i,{key:0,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Close Alert",color:"warning"},{default:l(()=>[b(r(t(V)),1)]),_:1})]),_:1})):y("",!0),t(D)?(c(),m(i,{key:1,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Close Alert",color:"error"},{default:l(()=>[b(r(t(D)),1)]),_:1})]),_:1})):y("",!0),t(g)?(c(),m(i,{key:2,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Close Alert",color:"success"},{default:l(()=>[b(r(t(g)),1)]),_:1})]),_:1})):y("",!0),e(i,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(B,{type:"submit",color:"error"},{default:l(()=>[b(" Eliminar ")]),_:1}),e(B,{color:"secondary",variant:"outlined",onClick:w},{default:l(()=>[b(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Sl={class:"text-center pb-6"},Cl={class:"text-h4 mb-2"},hl={__name:"PaymentEditDialog",props:{isDialogVisible:{type:Boolean,required:!0},paymentSelected:{type:Object,required:!0},sale_id:{type:String,required:!0}},emits:["update:isDialogVisible","editPayment"],setup(te,{emit:$}){const d=te,k=$,V=n(null),D=n(0),g=n(null),h=n(null),w=n(null),O=async()=>{g.value=null,h.value=null,w.value=null;let x={method_payment:V.value,amount:D.value,sale_id:d.sale_id};try{const I=await J("sale_payments/"+d.paymentSelected.id,{method:"PATCH",body:x,onResponseError({response:j}){h.value=j._data.error}});console.log(I),I.message==403?h.value=I.message_text:(w.value="El pago se ha editado correctamente",k("editPayment",I),g.value=null,h.value=null)}catch(I){console.log(I)}},_=()=>{k("update:isDialogVisible",!1)},A=x=>{k("update:isDialogVisible",x)};return fe(()=>{console.log(d.sale_id),V.value=d.paymentSelected.method_payment,D.value=d.paymentSelected.amount}),(x,I)=>{const j=Ce;return c(),m(xe,{"max-width":"650","model-value":d.isDialogVisible,"onUpdate:modelValue":A},{default:l(()=>[e(ee,{class:"pa-sm-11 pa-3"},{default:l(()=>[e(j,{variant:"text",size:"default",onClick:_}),e(oe,{class:"pt-5"},{default:l(()=>[s("div",Sl,[s("h4",Cl," Edit Payment : "+r(d.paymentSelected.method_payment),1)]),e(Te,{class:"mt-4",onSubmit:he(O,["prevent"])},{default:l(()=>[e(L,null,{default:l(()=>[e(i,{cols:"6"},{default:l(()=>[e(ve,{items:["EFECTIVO","DEPOSITO","TRANSFERENCIA","YAPE","PLIN"],modelValue:t(V),"onUpdate:modelValue":I[0]||(I[0]=N=>E(V)?V.value=N:null),label:"Metodo de Pago",placeholder:"Select Item",eager:""},null,8,["modelValue"])]),_:1}),e(i,{cols:"6"},{default:l(()=>[e(le,{label:"Importe",type:"number",modelValue:t(D),"onUpdate:modelValue":I[1]||(I[1]=N=>E(D)?D.value=N:null),placeholder:""},null,8,["modelValue"])]),_:1}),t(g)?(c(),m(i,{key:0,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Close Alert",color:"warning"},{default:l(()=>[b(r(t(g)),1)]),_:1})]),_:1})):y("",!0),t(h)?(c(),m(i,{key:1,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Close Alert",color:"error"},{default:l(()=>[b(r(t(h)),1)]),_:1})]),_:1})):y("",!0),t(w)?(c(),m(i,{key:2,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Close Alert",color:"success"},{default:l(()=>[b(r(t(w)),1)]),_:1})]),_:1})):y("",!0),e(i,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(B,{type:"submit"},{default:l(()=>[b(" Editar ")]),_:1}),e(B,{color:"secondary",variant:"outlined",onClick:_},{default:l(()=>[b(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Tl={class:"text-center pb-6"},xl={class:"text-h4 mb-2"},Ul={__name:"DetailDeleteDialog",props:{isDialogVisible:{type:Boolean,required:!0},saleDetailSelected:{type:Object,required:!0}},emits:["update:isDialogVisible","deleteSaleDetail"],setup(te,{emit:$}){const d=te,k=$,V=n(null),D=n(null),g=n(null),h=async()=>{V.value=null,D.value=null,g.value=null;try{const _=await J("sale_details/"+d.saleDetailSelected.id,{method:"DELETE",onResponseError({response:A}){D.value=A._data.error}});console.log(_),k("deleteSaleDetail",_),w()}catch(_){console.log(_)}};fe(()=>{console.log(d.saleDetailSelected)});const w=()=>{k("update:isDialogVisible",!1)},O=_=>{k("update:isDialogVisible",_)};return(_,A)=>{const x=Ce;return c(),m(xe,{"max-width":"650","model-value":d.isDialogVisible,"onUpdate:modelValue":O},{default:l(()=>[e(ee,{class:"pa-sm-11 pa-3"},{default:l(()=>[e(x,{variant:"text",size:"default",onClick:w}),e(oe,{class:"pt-5"},{default:l(()=>[s("div",Tl,[s("h4",xl," Delete Sale Detail : "+r(d.saleDetailSelected.id),1)]),e(Te,{class:"mt-4",onSubmit:he(h,["prevent"])},{default:l(()=>[e(L,null,{default:l(()=>[e(i,{cols:"12"},{default:l(()=>[s("p",null,"Â¿Estas seguro de eliminar el Detallado : "+r(d.saleDetailSelected.product.title)+"?",1)]),_:1}),t(V)?(c(),m(i,{key:0,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Close Alert",color:"warning"},{default:l(()=>[b(r(t(V)),1)]),_:1})]),_:1})):y("",!0),t(D)?(c(),m(i,{key:1,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Close Alert",color:"error"},{default:l(()=>[b(r(t(D)),1)]),_:1})]),_:1})):y("",!0),t(g)?(c(),m(i,{key:2,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Close Alert",color:"success"},{default:l(()=>[b(r(t(g)),1)]),_:1})]),_:1})):y("",!0),e(i,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(B,{type:"submit",color:"error"},{default:l(()=>[b(" Eliminar ")]),_:1}),e(B,{color:"secondary",variant:"outlined",onClick:w},{default:l(()=>[b(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},kl={class:"text-center pb-6"},wl={class:"text-h4 mb-2"},Il={__name:"DetailEditDialog",props:{isDialogVisible:{type:Boolean,required:!0},saleDetailSelected:{type:Object,required:!0},type_client:{type:Number,required:!0},type_sale:{type:Number,required:!0}},emits:["update:isDialogVisible","editSaleDetail"],setup(te,{emit:$}){const d=te,k=$,V=n(null),D=n(0),g=n(0),h=n(0),w=n([]),O=n(null),_=n(null),A=n(null),x=n(null),I=async()=>{if(_.value=null,A.value=null,x.value=null,!V.value){setTimeout(()=>{_.value="Necesitas seleccionar una unidad"},25);return}if(D.value<0){setTimeout(()=>{_.value="Necesitas ingresar una cantidad mayor a 0"},25);return}if(d.saleDetailSelected.product.is_gift==1&&(!g.value||g.value<=0)){setTimeout(()=>{_.value="Es necesario ingresar un precio"},25);return}if(d.saleDetailSelected.product.is_discount==2){let C=Number(d.saleDetailSelected.product.max_discount)*.01*Number(g.value);if(C<Number(h.value)){setTimeout(()=>{_.value="El descuento maximo del producto es : â‚¬"+C},25);return}}if(d.type_sale==1&&d.saleDetailSelected.product.disponibilidad==2){let p=d.saleDetailSelected.product.warehouses.find(U=>U.warehouse_id==d.saleDetailSelected.warehouse_id&&U.unit_id==V.value);if(p&&parseInt(p.stock)<parseInt(D.value)){setTimeout(()=>{_.value="El stock disponible de este producto es "+p.stock},25);return}}let P=0;d.saleDetailSelected.product.tax_selected==2?P=0:P=Number(g.value)*(d.saleDetailSelected.product.importe_iva*.01);let v={unit_id:V.value,price_unit:g.value??0,quantity:D.value,igv:P,discount:h.value,description:O.value};try{const C=await J("sale_details/"+d.saleDetailSelected.id,{method:"PATCH",body:v,onResponseError({response:p}){A.value=p._data.error}});console.log(C),C.message==403?A.value=C.message_text:(x.value="El detallado se ha editado correctamente",k("editSaleDetail",C),_.value=null,A.value=null)}catch(C){console.log(C)}},j=()=>{k("update:isDialogVisible",!1)},N=P=>{k("update:isDialogVisible",P)},ne=()=>{let P=V.value,v=d.type_client,C=JSON.parse(localStorage.getItem("user")),p=d.saleDetailSelected.product.wallets.find(U=>U.type_client==v&&U.unit_id==P&&U.sucursale_id==C.sucursale_id);if(console.log(v,P),p)g.value=p.price;else{let U=d.saleDetailSelected.product.wallets.find(q=>q.type_client==v&&q.unit_id==P&&q.sucursale_id==null);console.log(U),U?g.value=U.price:g.value=v==1?d.saleDetailSelected.product.price_general:d.saleDetailSelected.product.price_company}};return fe(()=>{w.value=d.saleDetailSelected.product.warehouses.filter(P=>P.warehouse_id==d.saleDetailSelected.warehouse_id).map(P=>({id:P.unit_id,name:P.unit.name})),V.value=d.saleDetailSelected.unit_id,D.value=d.saleDetailSelected.quantity,g.value=d.saleDetailSelected.price,h.value=d.saleDetailSelected.discount,O.value=d.saleDetailSelected.description}),(P,v)=>{const C=Ce;return c(),m(xe,{"max-width":"650","model-value":d.isDialogVisible,"onUpdate:modelValue":N},{default:l(()=>[e(ee,{class:"pa-sm-11 pa-3"},{default:l(()=>[e(C,{variant:"text",size:"default",onClick:j}),e(oe,{class:"pt-5"},{default:l(()=>[s("div",kl,[s("h4",wl," Edit Sale Detail : "+r(d.saleDetailSelected.id),1)]),e(Te,{class:"mt-4",onSubmit:he(I,["prevent"])},{default:l(()=>[e(L,null,{default:l(()=>[e(i,{cols:"6",md:"6"},{default:l(()=>[e(ve,{items:t(w),"item-title":"name","item-value":"id",placeholder:"Select",modelValue:t(V),"onUpdate:modelValue":[v[0]||(v[0]=p=>E(V)?V.value=p:null),v[1]||(v[1]=p=>ne())],label:"Unidades",disabled:d.saleDetailSelected.state_attention!=1},null,8,["items","modelValue","disabled"])]),_:1}),e(i,{cols:"6",md:"6"},{default:l(()=>[e(le,{label:"Cantidad",type:"number",modelValue:t(D),"onUpdate:modelValue":v[2]||(v[2]=p=>E(D)?D.value=p:null),placeholder:""},null,8,["modelValue"])]),_:1}),e(i,{cols:"6",md:"6"},{default:l(()=>[e(le,{label:"Precio Unitario (â‚¬)",type:"number",modelValue:t(g),"onUpdate:modelValue":v[3]||(v[3]=p=>E(g)?g.value=p:null),placeholder:""},null,8,["modelValue"])]),_:1}),e(i,{cols:"6",md:"6"},{default:l(()=>[e(le,{label:"Descuento (%)",type:"number",modelValue:t(h),"onUpdate:modelValue":v[4]||(v[4]=p=>E(h)?h.value=p:null),placeholder:""},null,8,["modelValue"])]),_:1}),e(i,{cols:"12"},{default:l(()=>[e(ze,{modelValue:t(O),"onUpdate:modelValue":v[5]||(v[5]=p=>E(O)?O.value=p:null),label:"DescripciÃ³n: ",placeholder:""},null,8,["modelValue"])]),_:1}),t(_)?(c(),m(i,{key:0,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Close Alert",color:"warning"},{default:l(()=>[b(r(t(_)),1)]),_:1})]),_:1})):y("",!0),t(A)?(c(),m(i,{key:1,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Close Alert",color:"error"},{default:l(()=>[b(r(t(A)),1)]),_:1})]),_:1})):y("",!0),t(x)?(c(),m(i,{key:2,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Close Alert",color:"success"},{default:l(()=>[b(r(t(x)),1)]),_:1})]),_:1})):y("",!0),e(i,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(B,{type:"submit"},{default:l(()=>[b(" Editar ")]),_:1}),e(B,{color:"secondary",variant:"outlined",onClick:j},{default:l(()=>[b(" Cancelar ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Nl={class:"d-flex flex-wrap justify-space-between gap-4 mb-6"},Pl={class:"d-flex flex-column justify-center"},Rl={class:"text-h4 mb-1"},Ol=s("p",{class:"text-body-1 mb-0"}," GestiÃ³n de pedidos y cotizaciones ",-1),Al=s("b",null,"Cliente:",-1),$l=s("br",null,null,-1),ql=s("b",null,"N.Âº Documento:",-1),Fl=s("p",{class:"my-0"},"Â¿Regalo?",-1),Ll=s("thead",null,[s("tr",null,[s("th",{class:"text-uppercase"},"AtenciÃ³n"),s("th",{class:"text-uppercase"},"Producto"),s("th",{class:"text-uppercase"},"E. Entrega"),s("th",{class:"text-uppercase"},"Unidad"),s("th",{class:"text-uppercase"},"Precio unitario"),s("th",{class:"text-uppercase"},"Cantidad"),s("th",{class:"text-uppercase"},"Descuento"),s("th",{class:"text-uppercase"},"Impuesto"),s("th",{class:"text-uppercase"},"Subtotal"),s("th",{class:"text-uppercase"},"Total"),s("th",{class:"text-uppercase"},"AcciÃ³n")])],-1),Bl={style:{"white-space":"nowrap"}},jl={style:{"white-space":"nowrap"}},zl={style:{"white-space":"nowrap"}},Hl={style:{"white-space":"nowrap"}},Xl={style:{"white-space":"nowrap"}},Ml={class:"d-flex gap-1"},Gl={style:{width:"100%"}},Wl=s("td",null,"Impuestos",-1),Yl=s("td",null,"Descuento",-1),Jl=s("td",null,"Subtotal",-1),Kl=s("td",null,"Total",-1),Ql=s("thead",null,[s("tr",null,[s("th",{class:"text-uppercase"},"MÃ©todo de pago"),s("th",{class:"text-uppercase"},"Importe"),s("th",{class:"text-uppercase"},"AcciÃ³n")])],-1),Zl=s("td",null,"Total pagado",-1),et=s("td",null,null,-1),lt=s("td",null,"Deuda",-1),tt=s("td",null,null,-1),$t={__name:"[id]",setup(te){const $=rl(),d=n(!1),k=n(!1),V=n(!1),D=n(!1),g=n(!1),h=n(!1),w=n(!1),O=n(null),_=n(null),A=n([]),x=n(null),I=n(null),j=n([]),N=n(null),ne=n(null),P=n([]),v=n(null),C=n(0),p=n(0),U=n(1),q=n(0),W=n([]),Ue=n(null),ke=n(null),ie=n(0),de=n(0),re=n(0),z=n(0),we=n(null),Q=n([]),ce=n(null),se=n(0),F=n(0),ue=n(null),Ie=n(null),Ne=n(null),Z=n(null),ye=n(null),H=o=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(Number(o??0)),Pe=n(!1),pe=n(),T=n(null),Re=n([]),X=n(null),be=n(null),He=o=>{Pe.value=!0,setTimeout(async()=>{try{const a=await J("sales/search_product?search="+(pe.value?pe.value:""),{method:"GET",onResponseError({response:f}){console.log(f._data.error)}});Re.value=a.products.data,Pe.value=!1}catch(a){console.log(a)}},500)};me(pe,o=>{if(X.value=null,be.value=null,!x.value){setTimeout(()=>{X.value="Es necesario seleccionar un almacÃ©n antes de escoger un producto"},25);return}if(!N.value){setTimeout(()=>{be.value="Es necesario seleccionar un cliente antes de escoger un producto"},25);return}(o||"").length>3?He():Re.value=[]}),me(T,o=>{o&&(P.value=o.warehouses.filter(a=>a.warehouse_id==x.value).map(a=>({id:a.unit_id,name:a.unit.name})),De())}),me(x,o=>{T.value&&(P.value=T.value.warehouses.filter(a=>a.warehouse_id==o).map(a=>({id:a.unit_id,name:a.unit.name})),De())}),me(v,o=>{if(!o)return;if(U.value==2){p.value=0,q.value=0;return}let a=o,f=N.value.type_client,M=JSON.parse(localStorage.getItem("user")),G=T.value.wallets.find(S=>S.type_client==f&&S.unit_id==a&&S.sucursale_id==M.sucursale_id);if(G)p.value=G.price;else{let S=T.value.wallets.find(K=>K.type_client==f&&K.unit_id==a&&K.sucursale_id==null);S?p.value=S.price:p.value=f==1?T.value.price_general:T.value.price_company}}),me(U,o=>{if(o==2)p.value=0,q.value=0;else if(T.value){let a=v.value;v.value="",setTimeout(()=>{v.value=a},25)}});const ge=n([]),Y=n("1");me(Y,o=>{o==2&&(Q.value=[],qe(),F.value=0)});const Xe=async()=>{try{const o=await J("sales/config",{method:"GET",onResponseError({response:f}){console.log(f._data.error)}});let a=JSON.parse(localStorage.getItem("user"));A.value=o.warehouses.filter(f=>f.sucursale_id==a.sucursale_id)}catch(o){console.log(o)}},Me=async()=>{d.value=!1,N.value=null,ne.value=null;try{const o=await J("sales/search_client?search="+(I.value?I.value:""),{method:"GET",onResponseError({response:a}){console.log(a._data.error)}});j.value=o.clients,j.value.length==1?Oe(j.value[0]):(j.value.length==0&&(ne.value="No se encontrÃ³ ninguna coincidencia"),setTimeout(()=>{d.value=!0},25))}catch(o){console.log(o)}},$e=o=>{Oe(o)},Oe=o=>{N.value=o,N.value.type_client=o.type_client,I.value=o.full_name,De()},De=()=>{p.value=0,v.value="",U.value=1,q.value=0,C.value=0},Ge=async()=>{if(X.value=null,!v.value){setTimeout(()=>{X.value="Es necesario seleccionar una unidad"},25);return}if(U.value==1&&(!p.value||p.value==0)){setTimeout(()=>{X.value="Es necesario ingresar un precio"},25);return}if(!C.value||C.value==0){setTimeout(()=>{X.value="Es necesario ingresar una cantidad"},25);return}U.value==2&&(p.value=0,q.value=0);let o=P.value.find(S=>S.id==v.value),a=0;T.value.tax_selected==2?a=0:a=Number(p.value)*(T.value.importe_iva*.01);let f=Number(p.value)-Number(q.value)+a;if(W.value.find(S=>S.product.id==T.value.id&&S.unit_id==v.value)){setTimeout(()=>{X.value="El producto y la unidad ya existen en el detalle, selecciona otro"},25);return}if(T.value.is_discount==2){let S=T.value.max_discount*.01*Number(p.value);if(S<Number(q.value)){setTimeout(()=>{X.value="El descuento mÃ¡ximo del producto es: "+H(S)},25);return}}if(Y.value==1&&T.value.disponibilidad==2){let K=T.value.warehouses.find(Ve=>Ve.warehouse_id==x.value&&Ve.unit_id==v.value);if(K&&parseInt(K.stock)<parseInt(C.value)){setTimeout(()=>{X.value="El stock disponible de este producto es "+K.stock},25);return}}let G={sale_id:$.params.id,product:T.value,unit_id:v.value,unit:o,warehouse_id:x.value,price:p.value,quantity:C.value,discount:q.value,is_gift:U.value,igv:a.toFixed(2),subtotal:f.toFixed(2),total:(f*parseInt(C.value)).toFixed(2)};try{const S=await J("sale_details",{method:"POST",body:G,onResponseError({response:K}){Z.value=K._data.error}});W.value.push(S.detail),setTimeout(()=>{ie.value=S.igv,de.value=S.discount,re.value=S.subtotal,z.value=S.total,De()},25)}catch(S){console.log(S)}},We=o=>{D.value=!0,Ue.value=o},Ye=o=>{z.value=o.total,de.value=o.discount,ie.value=o.igv,re.value=o.subtotal;let a=W.value.findIndex(f=>f.id==o.detail.id);a!=-1&&(W.value[a]=o.detail)},Je=(o,a)=>{X.value=null;let f=W.value[a].total;if(z.value-f<F.value){setTimeout(()=>{X.value="No se puede eliminar este producto porque el pago cancelado es mayor"},25);return}g.value=!0,ke.value=o},Ke=o=>{z.value=o.total,de.value=o.discount,ie.value=o.igv,re.value=o.subtotal;let a=W.value.findIndex(f=>f.id==o.sale_detail_id);a!=-1&&W.value.splice(a,1)},Qe=async()=>{if(ue.value=null,!ce.value){setTimeout(()=>{ue.value="El mÃ©todo de pago se tiene que seleccionar"},25);return}if(se.value==0){setTimeout(()=>{ue.value="El importe de pago debe ser mayor a 0"},25);return}if(z.value==0){setTimeout(()=>{ue.value="El total de la venta debe ser mayor a 0 para aÃ±adir un pago"},25);return}if(Number(F.value)+Number(se.value)>Number(z.value)){setTimeout(()=>{ue.value="El total pagado no puede ser mayor al total de la venta"},25);return}let o={method_payment:ce.value,amount:Number(se.value),sale_id:$.params.id};try{const a=await J("sale_payments",{method:"POST",body:o,onResponseError({response:f}){Z.value=f._data.error}});Q.value.unshift(a.payment),F.value=a.payment_total,al(),qe()}catch(a){console.log(a)}},Ze=o=>{Ie.value=o,h.value=!0},el=o=>{let a=o.payment;F.value=o.payment_total;let f=Q.value.findIndex(M=>M.id==a.id);f!=-1&&(Q.value[f]=a)},ll=o=>{w.value=!0,Ne.value=o},tl=o=>{let a=o.payment;F.value=o.payment_total;let f=Q.value.findIndex(M=>M.id==a.id);f!=-1&&Q.value.splice(f,1)},al=()=>{F.value=Q.value.reduce((o,a)=>o+Number(a.amount),0)},qe=()=>{ce.value="",se.value=0},ol=async()=>{try{if(Z.value=null,ye.value=null,W.value.length==0){setTimeout(()=>{Z.value="Es necesario agregar un producto al detalle"},25);return}if(!N.value){setTimeout(()=>{Z.value="Es necesario seleccionar un cliente para la venta"},25);return}if(Y.value==1&&Q.value.length==0){setTimeout(()=>{Z.value="Es necesario dar un adelanto para la venta"},25);return}let o=1;Y.value==1&&(F.value!=z.value&&(o=2),F.value==z.value&&(o=3));let a={client_id:N.value.id,type_client:N.value.type_client,discount:de.value,subtotal:re.value,total:z.value,igv:ie.value,state_sale:Y.value,state_payment:o,debt:z.value-F.value,paid_out:F.value,description:O.value};const f=await J("sales/"+$.params.id,{method:"PATCH",body:a,onResponseError({response:M}){Z.value=M._data.error}});ye.value="La "+(Y.value==1?"VENTA":"COTIZACIÃ“N")+" se ha EDITADO correctamente",Fe()}catch(o){console.log(o)}},Fe=async()=>{try{ge.value=[];const o=await J("sales/"+$.params.id,{method:"GET",onResponseError({response:a}){console.log(a._data.error)}});we.value=o.sale,N.value=o.sale.client,N.value.type_client=o.sale.type_client,I.value=N.value.full_name,_.value=o.sale.created_at,W.value=o.sale.sale_details,de.value=o.sale.discount,ie.value=o.sale.igv,re.value=o.sale.subtotal,z.value=o.sale.total,Q.value=o.sale.payments,F.value=o.sale.paid_out,O.value=o.sale.description,Y.value=o.sale.state_sale+"",ge.value.push({title:"Venta",value:"1",icon:"ri-shopping-cart-line"}),o.sale.state_sale==2&&ge.value.push({title:"CotizaciÃ³n",value:"2",icon:"ri-file-list-line"})}catch(o){console.log(o)}},sl=async o=>{try{let a={sale_detail_id:o.id};const f=await J("stock_attention_detail",{method:"POST",body:a,onResponseError({response:G}){Z.value=G._data.error}});let M=W.value.findIndex(G=>G.id==f.sale_detail.id);M!=-1&&(W.value[M]=f.sale_detail)}catch(a){console.log(a)}};return fe(()=>{Xe(),Fe()}),(o,a)=>{const f=_l,M=yl,G=fl,S=vl,K=pl,Ve=ml,ul=Il,nl=Ul,il=hl,dl=El;return c(),_e("div",null,[s("div",Nl,[s("div",Pl,[s("h4",Rl," ðŸ›ï¸ Editar venta / cotizaciÃ³n: #"+r(t($).params.id),1),Ol])]),e(ee,{class:"mb-6 py-4 px-4"},{default:l(()=>[e(f,{"selected-radio":t(Y),"onUpdate:selectedRadio":a[0]||(a[0]=u=>E(Y)?Y.value=u:null),"radio-content":t(ge),"grid-column":{sm:"6",cols:"12"}},null,8,["selected-radio","radio-content"])]),_:1}),e(ee,{class:"mb-6"},{default:l(()=>[e(oe,null,{default:l(()=>[e(L,null,{default:l(()=>[e(i,{cols:"3"},{default:l(()=>[e(M,{modelValue:t(_),"onUpdate:modelValue":a[1]||(a[1]=u=>E(_)?_.value=u:null),label:"Fecha de emisiÃ³n",placeholder:"Selecciona fecha",disabled:""},null,8,["modelValue"])]),_:1}),e(i,{cols:"3"},{default:l(()=>[e(ve,{items:t(A),"item-title":"name","item-value":"id",placeholder:"Seleccionar",modelValue:t(x),"onUpdate:modelValue":a[2]||(a[2]=u=>E(x)?x.value=u:null),label:"Almacenes"},null,8,["items","modelValue"])]),_:1}),e(i,{cols:"4"},{default:l(()=>[e(L,null,{default:l(()=>[e(i,{cols:"12"},{default:l(()=>[e(le,{label:"Cliente",modelValue:t(I),"onUpdate:modelValue":a[3]||(a[3]=u=>E(I)?I.value=u:null),"prepend-inner-icon":"ri-user-6-line",placeholder:"",onKeyup:a[4]||(a[4]=cl(u=>Me(),["enter"]))},null,8,["modelValue"])]),_:1}),t(N)?(c(),m(i,{key:0,cols:"12 py-0"},{default:l(()=>[s("span",null,[Al,b(" "+r(t(N).full_name),1)]),$l,s("span",null,[ql,b(" "+r(t(N).n_document),1)])]),_:1})):y("",!0),t(ne)?(c(),m(i,{key:1,cols:"12 py-0"},{default:l(()=>[e(R,{closable:"","close-label":"Cerrar",color:"warning"},{default:l(()=>[b(r(t(ne)),1)]),_:1})]),_:1})):y("",!0)]),_:1})]),_:1}),e(i,{cols:"2"},{default:l(()=>[e(B,{color:"secondary",class:"mx-2",onClick:a[5]||(a[5]=u=>k.value=!t(k))},{default:l(()=>[e(ae,{icon:"ri-user-add-line"})]),_:1}),e(B,{color:"secondary",onClick:a[6]||(a[6]=u=>V.value=!t(V))},{default:l(()=>[e(ae,{icon:"ri-community-line"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ee,{class:"mb-6"},{default:l(()=>[e(oe,null,{default:l(()=>[e(L,null,{default:l(()=>[e(i,{cols:"7"},{default:l(()=>[e(L,null,{default:l(()=>[e(i,{cols:"12"},{default:l(()=>[e(bl,{modelValue:t(T),"onUpdate:modelValue":a[7]||(a[7]=u=>E(T)?T.value=u:null),search:t(pe),"onUpdate:search":a[8]||(a[8]=u=>E(pe)?pe.value=u:null),loading:t(Pe),items:t(Re),"item-title":"title","item-value":"id","return-object":"",placeholder:"Buscar producto",label:"Â¿QuÃ© agregamos?",variant:"underlined","menu-props":{maxHeight:"200px"}},null,8,["modelValue","search","loading","items"])]),_:1}),t(X)?(c(),m(i,{key:0,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Cerrar",color:"warning"},{default:l(()=>[b(r(t(X)),1)]),_:1})]),_:1})):y("",!0),t(be)?(c(),m(i,{key:1,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Cerrar",color:"warning"},{default:l(()=>[b(r(t(be)),1)]),_:1})]),_:1})):y("",!0)]),_:1})]),_:1}),e(i,{cols:"5"},{default:l(()=>[e(L,null,{default:l(()=>[e(i,{cols:"10"},{default:l(()=>[e(L,null,{default:l(()=>[e(i,{cols:"4"},{default:l(()=>[e(ve,{items:t(P),"item-title":"name","item-value":"id",placeholder:"Seleccionar",modelValue:t(v),"onUpdate:modelValue":a[9]||(a[9]=u=>E(v)?v.value=u:null),label:"Unidades"},null,8,["items","modelValue"])]),_:1}),e(i,{cols:"4"},{default:l(()=>[e(le,{label:"Precio",type:"number",modelValue:t(p),"onUpdate:modelValue":a[10]||(a[10]=u=>E(p)?p.value=u:null),placeholder:"",disabled:t(U)==2?!0:null},null,8,["modelValue","disabled"])]),_:1}),e(i,{cols:"4"},{default:l(()=>[e(le,{label:"Cantidad",type:"number",modelValue:t(C),"onUpdate:modelValue":a[11]||(a[11]=u=>E(C)?C.value=u:null),placeholder:""},null,8,["modelValue"])]),_:1}),t(T)&&t(T).is_gift==2?(c(),m(i,{key:0,cols:"4"},{default:l(()=>[Fl,e(gl,{label:"SÃ­",value:"2",modelValue:t(U),"onUpdate:modelValue":a[12]||(a[12]=u=>E(U)?U.value=u:null)},null,8,["modelValue"])]),_:1})):y("",!0),t(T)&&t(T).is_discount==2?(c(),m(i,{key:1,cols:"4"},{default:l(()=>[e(le,{label:"Descuento",type:"number",modelValue:t(q),"onUpdate:modelValue":a[13]||(a[13]=u=>E(q)?q.value=u:null),placeholder:"",disabled:t(U)==2?!0:null},null,8,["modelValue","disabled"])]),_:1})):y("",!0)]),_:1})]),_:1}),e(i,{cols:"2"},{default:l(()=>[e(B,{color:"primary",onClick:a[14]||(a[14]=u=>Ge())},{default:l(()=>[e(ae,{icon:"ri-add-circle-line"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ee,{class:"mb-6"},{default:l(()=>[e(oe,null,{default:l(()=>[e(L,null,{default:l(()=>[e(i,{cols:"12"},{default:l(()=>[e(je,null,{default:l(()=>[Ll,s("tbody",null,[(c(!0),_e(Le,null,Be(t(W),(u,Ee)=>(c(),_e("tr",{key:Ee},[s("td",null,[u.state_attention!=3&&t(we).state_sale==1?(c(),m(B,{key:0,onClick:Se=>sl(u),icon:"ri-contract-line",variant:"text"},null,8,["onClick"])):y("",!0)]),s("td",null,r(u.product.title),1),s("td",null,[u.state_attention==1?(c(),m(Ae,{key:0,color:"error"},{default:l(()=>[b("Pendiente")]),_:1})):y("",!0),u.state_attention==2?(c(),m(Ae,{key:1,color:"warning"},{default:l(()=>[b("Parcial")]),_:1})):y("",!0),u.state_attention==3?(c(),m(Ae,{key:2,color:"primary"},{default:l(()=>[b("Completo")]),_:1})):y("",!0)]),s("td",null,r(u.unit.name),1),s("td",Bl,r(H(u.price)),1),s("td",null,r(u.quantity),1),s("td",jl,r(H(u.discount)),1),s("td",zl,r(H(u.igv)),1),s("td",Hl,r(H(u.subtotal)),1),s("td",Xl,r(H(u.total)),1),s("td",null,[s("div",Ml,[e(G,{size:"small",onClick:Se=>We(u)},{default:l(()=>[e(ae,{icon:"ri-pencil-line"})]),_:2},1032,["onClick"]),u.state_attention==1?(c(),m(G,{key:0,size:"small",onClick:Se=>Je(u,Ee)},{default:l(()=>[e(ae,{icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])):y("",!0)])])]))),128))])]),_:1})]),_:1}),e(i,{cols:"7"}),e(i,{cols:"5"},{default:l(()=>[s("table",Gl,[s("tr",null,[Wl,s("td",null,r(H(t(ie))),1)]),s("tr",null,[Yl,s("td",null,r(H(t(de))),1)]),s("tr",null,[Jl,s("td",null,r(H(t(re))),1)]),s("tr",null,[Kl,s("td",null,r(H(t(z))),1)])])]),_:1})]),_:1})]),_:1})]),_:1}),e(ee,{class:"mb-6"},{default:l(()=>[e(oe,null,{default:l(()=>[e(L,null,{default:l(()=>[t(Y)==1?(c(),m(i,{key:0,cols:"8"},{default:l(()=>[e(L,null,{default:l(()=>[e(i,{cols:"4"},{default:l(()=>[e(ve,{placeholder:"Seleccionar",label:"MÃ©todos de pago",items:["EFECTIVO","DEPOSITO","TRANSFERENCIA","YAPE","PLIN"],modelValue:t(ce),"onUpdate:modelValue":a[15]||(a[15]=u=>E(ce)?ce.value=u:null)},null,8,["modelValue"])]),_:1}),e(i,{cols:"4"},{default:l(()=>[e(le,{label:"Importe",type:"number",modelValue:t(se),"onUpdate:modelValue":a[16]||(a[16]=u=>E(se)?se.value=u:null),placeholder:""},null,8,["modelValue"])]),_:1}),e(i,{cols:"4"},{default:l(()=>[e(B,{color:"primary",onClick:a[17]||(a[17]=u=>Qe())},{default:l(()=>[e(ae,{icon:"ri-add-circle-line"})]),_:1})]),_:1}),t(ue)?(c(),m(i,{key:0,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Cerrar",color:"warning"},{default:l(()=>[b(r(t(ue)),1)]),_:1})]),_:1})):y("",!0)]),_:1}),e(L,null,{default:l(()=>[e(i,{cols:"10"},{default:l(()=>[e(je,null,{default:l(()=>[Ql,s("tbody",null,[(c(!0),_e(Le,null,Be(t(Q),(u,Ee)=>(c(),_e("tr",{key:Ee},[s("td",null,r(u.method_payment),1),s("td",null,r(H(u.amount)),1),s("td",null,[e(G,{size:"small",onClick:Se=>Ze(u)},{default:l(()=>[e(ae,{icon:"ri-pencil-line"})]),_:2},1032,["onClick"]),e(G,{size:"small",onClick:Se=>ll(u)},{default:l(()=>[e(ae,{icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])])]))),128)),s("tr",null,[Zl,s("td",null,r(H(t(F))),1),et]),s("tr",null,[lt,s("td",null,r(H((t(z)-t(F)).toFixed(2))),1),tt])])]),_:1})]),_:1})]),_:1})]),_:1})):y("",!0),e(i,{cols:"4"},{default:l(()=>[e(ze,{label:"DescripciÃ³n",placeholder:"",modelValue:t(O),"onUpdate:modelValue":a[18]||(a[18]=u=>E(O)?O.value=u:null)},null,8,["modelValue"])]),_:1}),t(Z)?(c(),m(i,{key:1,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Cerrar",color:"warning"},{default:l(()=>[b(r(t(Z)),1)]),_:1})]),_:1})):y("",!0),t(ye)?(c(),m(i,{key:2,cols:"12"},{default:l(()=>[e(R,{closable:"","close-label":"Cerrar",color:"success"},{default:l(()=>[b(r(t(ye)),1)]),_:1})]),_:1})):y("",!0),e(i,{cols:"12"},{default:l(()=>[e(B,{block:"",onClick:ol},{default:l(()=>[b(" Editar "+r(t(Y)==1?"venta":"cotizaciÃ³n"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(j).length>0&&t(d)?(c(),m(S,{key:0,isDialogVisible:t(d),"onUpdate:isDialogVisible":a[19]||(a[19]=u=>E(d)?d.value=u:null),listClients:t(j),onClientSelected:Oe},null,8,["isDialogVisible","listClients"])):y("",!0),e(K,{isDialogVisible:t(k),"onUpdate:isDialogVisible":a[20]||(a[20]=u=>E(k)?k.value=u:null),onAddClient:$e},null,8,["isDialogVisible"]),e(Ve,{isDialogVisible:t(V),"onUpdate:isDialogVisible":a[21]||(a[21]=u=>E(V)?V.value=u:null),onAddClient:$e},null,8,["isDialogVisible"]),t(Ue)&&t(D)?(c(),m(ul,{key:1,isDialogVisible:t(D),"onUpdate:isDialogVisible":a[22]||(a[22]=u=>E(D)?D.value=u:null),saleDetailSelected:t(Ue),type_client:t(N).type_client,type_sale:t(we).state_sale,onEditSaleDetail:Ye},null,8,["isDialogVisible","saleDetailSelected","type_client","type_sale"])):y("",!0),t(ke)&&t(g)?(c(),m(nl,{key:2,isDialogVisible:t(g),"onUpdate:isDialogVisible":a[23]||(a[23]=u=>E(g)?g.value=u:null),saleDetailSelected:t(ke),onDeleteSaleDetail:Ke},null,8,["isDialogVisible","saleDetailSelected"])):y("",!0),t(Ie)&&t(h)?(c(),m(il,{key:3,isDialogVisible:t(h),"onUpdate:isDialogVisible":a[24]||(a[24]=u=>E(h)?h.value=u:null),paymentSelected:t(Ie),sale_id:t($).params.id,onEditPayment:el},null,8,["isDialogVisible","paymentSelected","sale_id"])):y("",!0),t(Ne)&&t(w)?(c(),m(dl,{key:4,isDialogVisible:t(w),"onUpdate:isDialogVisible":a[25]||(a[25]=u=>E(w)?w.value=u:null),paymentSelected:t(Ne),onDeletePayment:tl},null,8,["isDialogVisible","paymentSelected"])):y("",!0)])}}};export{$t as default};
