import{_ as re}from"./IconBtn-DDZ12Udw.js";import{_ as ne}from"./AppDateTimePicker-DtxdjnaA.js";import{$ as L}from"./api-fBbxbWV9.js";import{a as n,V as y}from"./VRow-CKub-qAo.js";import{V as j}from"./VCard-BsRs2Dbz.js";import{V as X}from"./VCardText-fQi82b2X.js";import{V}from"./VTextField-BvYPkTzd.js";import{V as F}from"./VSelect-Ce3hOZLi.js";import{V as se}from"./VTextarea-x2-n2yy5.js";import{V as M}from"./VAlert-ku1xFGr_.js";import{V as de}from"./VAutocomplete-CE6caHRp.js";import{r as s,x as O,o as ie,h as G,a as S,d as u,b as e,w as a,u as o,i as d,c as H,f as z,g as P,t as b,V as Y,l as Z,F as ce,j as me}from"./index-C2VmLSsf.js";import{V as pe}from"./VTable-Rng3EBBw.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./index-BYrzgnBV.js";/* empty css              */import"./VAvatar-CrWFUmzB.js";import"./VImg-BjZkJGgN.js";import"./forwardRefs-DWGaNmQL.js";import"./VList-C6VPgDKA.js";import"./VDivider-IUxUQjJr.js";import"./VOverlay-BuiK-fz4.js";import"./VMenu-Dk04Zlg9.js";import"./VCheckboxBtn-D1ZcYjYr.js";import"./VChip-DLC_ftk3.js";import"./filter-BT5ZVbsJ.js";const ve=u("div",{class:"d-flex flex-wrap justify-space-between gap-4 mb-6"},[u("div",{class:"d-flex flex-column justify-center"},[u("h4",{class:"text-h4 mb-1"},"ðŸ—ƒï¸ AÃ±adir nueva compra"),u("p",{class:"text-body-1 mb-0"})])],-1),fe=u("thead",null,[u("tr",null,[u("th",{class:"text-uppercase"},"Producto"),u("th",{class:"text-uppercase"},"Unidad"),u("th",{class:"text-uppercase"},"Precio unitario"),u("th",{class:"text-uppercase"},"Cantidad"),u("th",{class:"text-uppercase"},"Total"),u("th",{class:"text-uppercase"},"AcciÃ³n")])],-1),_e=u("td",null,null,-1),Ve=u("td",null,null,-1),be=u("td",null,null,-1),ge=.21,Qe={__name:"add",setup(Te){const R=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null,p=s(null),w=s(null),E=s(null),x=s(null),h=s(null),U=s(null),N=s(0),A=s(0),k=s(0),q=s([]),J=s([]),Q=s([]),g=s([]),i=s(null),D=s(null),B=s(!1),C=s(),T=s(null),$=s([]),c=s(null),v=s(null),f=s(0),_=s(0),I=r=>{const l=Number(r??0);try{return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(l)}catch{return`${l.toLocaleString("es-ES")} â‚¬`}},ee=r=>{B.value=!0,setTimeout(async()=>{try{const l=await L(`sales/search_product?search=${C.value||""}`,{method:"GET",onResponseError({response:m}){console.log(m._data.error)}});$.value=l.products.data,B.value=!1}catch(l){console.log(l)}},500)};O(C,r=>{if(c.value=null,!p.value){setTimeout(()=>{c.value="Es necesario seleccionar un almacÃ©n antes de escoger un producto"},25);return}(r||"").length>3?ee():$.value=[]}),O(T,r=>{}),O(p,r=>{}),O(v,r=>{});const le=()=>{if(c.value=null,!T.value){setTimeout(()=>{c.value="Es necesario seleccionar un producto"},25);return}if(!v.value){setTimeout(()=>{c.value="Es necesario seleccionar una unidad"},25);return}if(!f.value&&f.value!==0){setTimeout(()=>{c.value="Es necesario indicar un precio unitario"},25);return}if(!_.value||_.value<=0){setTimeout(()=>{c.value="Es necesario indicar una cantidad mayor a 0"},25);return}const r=q.value.find(m=>m.id==v.value),l=Number((Number(f.value)*Number(_.value)).toFixed(2));g.value.push({product:T.value,unit_id:v.value,unit:r,price_unit:Number(f.value),quantity:Number(_.value),total:l}),setTimeout(()=>{K(),v.value="",f.value=0,_.value=0,T.value=null,C.value=""},25)},K=()=>{const r=g.value.reduce((l,m)=>l+Number(m.total),0);N.value=Number(r.toFixed(2)),A.value=Number((N.value*ge).toFixed(2)),k.value=Number((N.value+A.value).toFixed(2))},ae=(r,l)=>{g.value.splice(l,1),K()},te=async()=>{try{if(i.value=null,D.value=null,!p.value){setTimeout(()=>i.value="Es requerido seleccionar un almacÃ©n",25);return}if(!h.value){setTimeout(()=>i.value="Es requerido seleccionar un proveedor",25);return}if(!E.value){setTimeout(()=>i.value="Es requerido seleccionar un tipo de comprobante",25);return}if(!x.value){setTimeout(()=>i.value="Es requerido indicar el NÂº de comprobante",25);return}if(g.value.length===0){setTimeout(()=>i.value="AÃ±ade al menos un producto al detalle",25);return}const r={warehouse_id:p.value,provider_id:h.value,date_emision:w.value,type_comprobant:E.value,n_comprobant:x.value,purchase_details:g.value,description:U.value,total:k.value,importe:N.value,igv:A.value},l=await L("purchase",{method:"POST",body:r,onResponseError({response:m}){i.value=m._data.error}});console.log(l),D.value="La compra se ha registrado correctamente",setTimeout(()=>{p.value="",h.value="",E.value="",x.value="",U.value="",g.value=[],k.value=0,N.value=0,A.value=0},25)}catch(r){console.log(r)}},oe=async()=>{try{const r=await L("purchase/config",{method:"GET",onResponseError({response:l}){console.log(l._data.error)}});J.value=r.warehouses,q.value=r.units,Q.value=r.providers,w.value=r.today}catch(r){console.log(r)}};return ie(()=>{oe()}),(r,l)=>{const m=ne,ue=re;return S(),G("div",null,[ve,e(y,null,{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(j,{class:"mb-6",title:"InformaciÃ³n general"},{default:a(()=>[e(X,null,{default:a(()=>[e(y,null,{default:a(()=>[e(n,{cols:"3"},{default:a(()=>[e(V,{label:"Solicitante",disabled:"",modelValue:o(R).full_name,"onUpdate:modelValue":l[0]||(l[0]=t=>o(R).full_name=t)},null,8,["modelValue"])]),_:1}),e(n,{cols:"3"},{default:a(()=>[e(V,{label:"Sucursal",disabled:"",modelValue:o(R).sucursale.name,"onUpdate:modelValue":l[1]||(l[1]=t=>o(R).sucursale.name=t)},null,8,["modelValue"])]),_:1}),e(n,{cols:"3"},{default:a(()=>[e(F,{modelValue:o(p),"onUpdate:modelValue":l[2]||(l[2]=t=>d(p)?p.value=t:null),items:o(J),label:"Almacenes",placeholder:"Seleccionar almacÃ©n","item-title":"name","item-value":"id",eager:""},null,8,["modelValue","items"])]),_:1}),e(n,{cols:"3"},{default:a(()=>[e(F,{modelValue:o(h),"onUpdate:modelValue":l[3]||(l[3]=t=>d(h)?h.value=t:null),items:o(Q),label:"Proveedores",placeholder:"Seleccionar proveedor","item-title":"full_name","item-value":"id",eager:""},null,8,["modelValue","items"])]),_:1})]),_:1}),e(y,null,{default:a(()=>[e(n,{cols:"3"},{default:a(()=>[e(m,{label:"Fecha de emisiÃ³n",placeholder:"Seleccionar fecha",modelValue:o(w),"onUpdate:modelValue":l[4]||(l[4]=t=>d(w)?w.value=t:null)},null,8,["modelValue"])]),_:1}),e(n,{cols:"3"},{default:a(()=>[e(F,{items:["FACTURA ELECTRÃ“NICA","NOTA DE CRÃ‰DITO","NOTA DE DÃ‰BITO","RECIBO DE HONORARIOS","GUÃA DE REMISIÃ“N"],modelValue:o(E),"onUpdate:modelValue":l[5]||(l[5]=t=>d(E)?E.value=t:null),label:"Tipo de comprobante",placeholder:"Seleccionar tipo",eager:""},null,8,["modelValue"])]),_:1}),e(n,{cols:"3"},{default:a(()=>[e(V,{modelValue:o(x),"onUpdate:modelValue":l[6]||(l[6]=t=>d(x)?x.value=t:null),label:"NÂº de comprobante"},null,8,["modelValue"])]),_:1}),e(n,{cols:"3"},{default:a(()=>[e(se,{label:"Nota",modelValue:o(U),"onUpdate:modelValue":l[7]||(l[7]=t=>d(U)?U.value=t:null)},null,8,["modelValue"])]),_:1}),o(i)?(S(),H(n,{key:0,cols:"12"},{default:a(()=>[e(M,{closable:"","close-label":"Cerrar alerta",color:"warning"},{default:a(()=>[P(b(o(i)),1)]),_:1})]),_:1})):z("",!0),o(D)?(S(),H(n,{key:1,cols:"12"},{default:a(()=>[e(M,{closable:"","close-label":"Cerrar alerta",color:"success"},{default:a(()=>[P(b(o(D)),1)]),_:1})]),_:1})):z("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(n,{cols:"12"},{default:a(()=>[e(j,{class:"mb-6",title:"Producto solicitado"},{default:a(()=>[e(X,null,{default:a(()=>[e(y,null,{default:a(()=>[e(n,{cols:"7"},{default:a(()=>[e(y,null,{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(de,{modelValue:o(T),"onUpdate:modelValue":l[8]||(l[8]=t=>d(T)?T.value=t:null),search:o(C),"onUpdate:search":l[9]||(l[9]=t=>d(C)?C.value=t:null),loading:o(B),items:o($),"item-title":"title","item-value":"id","return-object":"",placeholder:"Buscar producto",label:"Â¿QuÃ© agregamos?",variant:"underlined","menu-props":{maxHeight:"200px"}},null,8,["modelValue","search","loading","items"])]),_:1}),o(c)?(S(),H(n,{key:0,cols:"12"},{default:a(()=>[e(M,{closable:"","close-label":"Cerrar alerta",color:"warning"},{default:a(()=>[P(b(o(c)),1)]),_:1})]),_:1})):z("",!0)]),_:1})]),_:1}),e(n,{cols:"5"},{default:a(()=>[e(y,null,{default:a(()=>[e(n,{cols:"10"},{default:a(()=>[e(y,null,{default:a(()=>[e(n,{cols:"4"},{default:a(()=>[e(F,{items:o(q),"item-title":"name","item-value":"id",placeholder:"Seleccionar",modelValue:o(v),"onUpdate:modelValue":l[10]||(l[10]=t=>d(v)?v.value=t:null),label:"Unidades"},null,8,["items","modelValue"])]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(V,{label:"Precio unitario",type:"number",inputmode:"decimal",step:"0.01",prefix:"â‚¬",modelValue:o(f),"onUpdate:modelValue":l[11]||(l[11]=t=>d(f)?f.value=t:null),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),e(n,{cols:"4"},{default:a(()=>[e(V,{label:"Cantidad",type:"number",inputmode:"decimal",step:"0.01",modelValue:o(_),"onUpdate:modelValue":l[12]||(l[12]=t=>d(_)?_.value=t:null),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(n,{cols:"2"},{default:a(()=>[e(Y,{color:"primary",onClick:l[13]||(l[13]=t=>le())},{default:a(()=>[e(Z,{icon:"ri-add-circle-line"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(n,{cols:"12"},{default:a(()=>[e(j,{class:"mb-6",title:"Detalle de la compra"},{default:a(()=>[e(pe,null,{default:a(()=>[fe,u("tbody",null,[(S(!0),G(ce,null,me(o(g),(t,W)=>(S(),G("tr",{key:W},[u("td",null,b(t.product.title),1),u("td",null,b(t.unit.name),1),u("td",null,b(I(t.price_unit)),1),u("td",null,b(t.quantity),1),u("td",null,b(I(t.total)),1),u("td",null,[e(ue,{size:"small",onClick:ye=>ae(t,W)},{default:a(()=>[e(Z,{icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])])]))),128)),u("tr",null,[_e,Ve,u("td",null,[e(V,{label:"Importe","model-value":I(o(N)),readonly:""},null,8,["model-value"])]),u("td",null,[e(V,{label:"IVA (21%)","model-value":I(o(A)),readonly:""},null,8,["model-value"])]),u("td",null,[e(V,{label:"Total","model-value":I(o(k)),readonly:""},null,8,["model-value"])]),be])])]),_:1})]),_:1})]),_:1}),e(n,{cols:"12"},{default:a(()=>[e(Y,{block:"",onClick:te},{default:a(()=>[P("Registrar compra")]),_:1})]),_:1})]),_:1})])}}};export{Qe as default};
