import{_ as de}from"./DialogCloseBtn-CmFX9Z5g.js";import{r as s,o as se,c as b,a as m,w as l,b as e,d as i,t as _,e as ce,f as D,u as a,g,V as M,i as f,q as Se,x as ee,h as oe,l as ue,F as we,j as Te}from"./index-CTHS9Uo5.js";import{$ as j}from"./api-DV6oDQ6t.js";import{V as W}from"./VCard-DCSOa-uS.js";import{V as le}from"./VCardText-DvHr5E0T.js";import{V as pe}from"./VForm-DutAvWyc.js";import{V as O,a as r}from"./VRow-BhAPnYDA.js";import{V as $}from"./VAlert-DEc64QkE.js";import{V as me}from"./VDialog-BCy7d4kf.js";import{V as K}from"./VSelect-I2Djs2tK.js";import{V as I}from"./VTextField-ZaB3RHnj.js";import{V as ve}from"./VTextarea-7f9Dtzos.js";import{_ as ke}from"./IconBtn-DXVljAVB.js";import{_ as Pe}from"./AppDateTimePicker-BCLx0bW5.js";import{V as Ue}from"./VAutocomplete-Deg3ZH1f.js";import{V as Ie}from"./VTable-2kho1lTo.js";import{V as ne}from"./VChip-C2kZ6mQo.js";import"./index-BYrzgnBV.js";import"./VAvatar-B74PEF1E.js";import"./VImg-DbUZi3rZ.js";import"./forwardRefs-DWGaNmQL.js";/* empty css              */import"./VOverlay-CQPilPWj.js";import"./VList-BeeB6M1u.js";import"./VDivider-D7LS911x.js";import"./VMenu-B-CF11VB.js";import"./VCheckboxBtn-Mk3d90yG.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./filter-DF6NMxOv.js";const Ne={class:"text-center pb-6"},Re={class:"text-h4 mb-2"},qe={__name:"PurchaseDetailDeleteDialog",props:{isDialogVisible:{type:Boolean,required:!0},purchaseDetailSelected:{type:Object,required:!0}},emits:["update:isDialogVisible","deletePurchaseDetail"],setup(Y,{emit:T}){const n=Y,C=T,y=s(null),v=s(null),h=s(null),S=async()=>{y.value=null,v.value=null,h.value=null;try{const c=await j("purchase_details/"+n.purchaseDetailSelected.id,{method:"DELETE",onResponseError({response:x}){v.value=x._data.error}});console.log(c),C("deletePurchaseDetail",c),E()}catch(c){console.log(c)}};se(()=>{console.log(n.purchaseDetailSelected)});const E=()=>{C("update:isDialogVisible",!1)},V=c=>{C("update:isDialogVisible",c)};return(c,x)=>{const N=de;return m(),b(me,{"max-width":"650","model-value":n.isDialogVisible,"onUpdate:modelValue":V},{default:l(()=>[e(W,{class:"pa-sm-11 pa-3"},{default:l(()=>[e(N,{variant:"text",size:"default",onClick:E}),e(le,{class:"pt-5"},{default:l(()=>[i("div",Ne,[i("h4",Re," Delete Purchase Detail : "+_(n.purchaseDetailSelected.id),1)]),e(pe,{class:"mt-4",onSubmit:ce(S,["prevent"])},{default:l(()=>[e(O,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[i("p",null,"Â¿Estas seguro de eliminar el Detallado : "+_(n.purchaseDetailSelected.product.title)+"?",1)]),_:1}),a(y)?(m(),b(r,{key:0,cols:"12"},{default:l(()=>[e($,{closable:"","close-label":"Close Alert",color:"warning"},{default:l(()=>[g(_(a(y)),1)]),_:1})]),_:1})):D("",!0),a(v)?(m(),b(r,{key:1,cols:"12"},{default:l(()=>[e($,{closable:"","close-label":"Close Alert",color:"error"},{default:l(()=>[g(_(a(v)),1)]),_:1})]),_:1})):D("",!0),a(h)?(m(),b(r,{key:2,cols:"12"},{default:l(()=>[e($,{closable:"","close-label":"Close Alert",color:"success"},{default:l(()=>[g(_(a(h)),1)]),_:1})]),_:1})):D("",!0),e(r,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(M,{type:"submit",color:"error"},{default:l(()=>[g(" Eliminar ")]),_:1}),e(M,{color:"secondary",variant:"outlined",onClick:E},{default:l(()=>[g(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Oe={class:"text-center pb-6"},$e={class:"text-h4 mb-2"},Be={__name:"PurchaseDetailEditDialog",props:{isDialogVisible:{type:Boolean,required:!0},purchaseDetailSelected:{type:Object,required:!0},units:{type:Object,required:!0},purchase_id:{type:String,required:!0}},emits:["update:isDialogVisible","editPurchaseDetail"],setup(Y,{emit:T}){const n=Y,C=T,y=s(null),v=s(0),h=s(0),S=s([]),E=s(null),V=s(null),c=s(null),x=s(null),N=async()=>{if(V.value=null,c.value=null,x.value=null,!y.value){setTimeout(()=>{V.value="Necesitas seleccionar una unidad"},25);return}if(v.value<0){setTimeout(()=>{V.value="Necesitas ingresar una cantidad mayor a 0"},25);return}if(!h.value||h.value<=0){setTimeout(()=>{V.value="Es necesario ingresar un precio"},25);return}let k={unit_id:y.value,price_unit:h.value??0,quantity:v.value,description:E.value,purchase_id:n.purchase_id,total:Number((h.value*v.value).toFixed(2))};try{const p=await j("purchase_details/"+n.purchaseDetailSelected.id,{method:"PATCH",body:k,onResponseError({response:X}){c.value=X._data.error}});console.log(p),p.message==403?c.value=p.message_text:(x.value="El detallado de la compra se ha editado correctamente",C("editPurchaseDetail",p),V.value=null,c.value=null)}catch(p){console.log(p)}},B=()=>{C("update:isDialogVisible",!1)},z=k=>{C("update:isDialogVisible",k)};return se(()=>{y.value=n.purchaseDetailSelected.unit_id,v.value=n.purchaseDetailSelected.quantity,h.value=n.purchaseDetailSelected.price_unit,E.value=n.purchaseDetailSelected.description,S.value=n.units}),(k,p)=>{const X=de;return m(),b(me,{"max-width":"650","model-value":n.isDialogVisible,"onUpdate:modelValue":z},{default:l(()=>[e(W,{class:"pa-sm-11 pa-3"},{default:l(()=>[e(X,{variant:"text",size:"default",onClick:B}),e(le,{class:"pt-5"},{default:l(()=>[i("div",Oe,[i("h4",$e," Edit Purchase Detail : "+_(n.purchaseDetailSelected.id),1)]),e(pe,{class:"mt-4",onSubmit:ce(N,["prevent"])},{default:l(()=>[e(O,null,{default:l(()=>[e(r,{cols:"6",md:"6"},{default:l(()=>[e(K,{items:a(S),"item-title":"name","item-value":"id",placeholder:"Select",modelValue:a(y),"onUpdate:modelValue":p[0]||(p[0]=P=>f(y)?y.value=P:null),label:"Unidades",disabled:n.purchaseDetailSelected.state!=1},null,8,["items","modelValue","disabled"])]),_:1}),e(r,{cols:"6",md:"6"},{default:l(()=>[e(I,{label:"Cantidad",type:"number",modelValue:a(v),"onUpdate:modelValue":p[1]||(p[1]=P=>f(v)?v.value=P:null),disabled:n.purchaseDetailSelected.state!=1,placeholder:""},null,8,["modelValue","disabled"])]),_:1}),e(r,{cols:"4"},{default:l(()=>[e(I,{label:"Precio Unitario",type:"number",modelValue:a(h),"onUpdate:modelValue":p[2]||(p[2]=P=>f(h)?h.value=P:null),placeholder:""},null,8,["modelValue"])]),_:1}),e(r,{cols:"8"},{default:l(()=>[e(ve,{modelValue:a(E),"onUpdate:modelValue":p[3]||(p[3]=P=>f(E)?E.value=P:null),label:"DescripciÃ³n: ",placeholder:""},null,8,["modelValue"])]),_:1}),a(V)?(m(),b(r,{key:0,cols:"12"},{default:l(()=>[e($,{closable:"","close-label":"Close Alert",color:"warning"},{default:l(()=>[g(_(a(V)),1)]),_:1})]),_:1})):D("",!0),a(c)?(m(),b(r,{key:1,cols:"12"},{default:l(()=>[e($,{closable:"","close-label":"Close Alert",color:"error"},{default:l(()=>[g(_(a(c)),1)]),_:1})]),_:1})):D("",!0),a(x)?(m(),b(r,{key:2,cols:"12"},{default:l(()=>[e($,{closable:"","close-label":"Close Alert",color:"success"},{default:l(()=>[g(_(a(x)),1)]),_:1})]),_:1})):D("",!0),e(r,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(M,{type:"submit"},{default:l(()=>[g(" Editar ")]),_:1}),e(M,{color:"secondary",variant:"outlined",onClick:B},{default:l(()=>[g(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}},Fe={class:"d-flex flex-wrap justify-space-between gap-4 mb-6"},Ae={class:"d-flex flex-column justify-center"},je={class:"text-h4 mb-1"},ze=i("p",{class:"text-body-1 mb-0"}," GestiÃ³n y actualizaciÃ³n de compras ",-1),Ge=i("thead",null,[i("tr",null,[i("th",{class:"text-uppercase"}),i("th",{class:"text-uppercase"},"Estado E."),i("th",{class:"text-uppercase"},"Producto"),i("th",{class:"text-uppercase"},"Unidad"),i("th",{class:"text-uppercase"},"Precio unitario"),i("th",{class:"text-uppercase"},"Cantidad"),i("th",{class:"text-uppercase"},"Total"),i("th",{class:"text-uppercase"},"AcciÃ³n")])],-1),Le={class:"d-flex align-center"},He=i("td",null,null,-1),Me=i("td",null,null,-1),Xe=i("td",null,null,-1),El={__name:"[id]",setup(Y){const T=Se(),n=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null,C=s(!1),y=s(null),v=s(!1),h=s(null),S=s(null),E=s(null),V=s(null),c=s(null),x=s(null),N=s(null),B=s(0),z=s(0),k=s(0),p=s([]),X=s([]),P=s([]),U=s([]),w=s(null),Z=s(null),J=o=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(Number(o??0)),ae=s(!1),G=s(),L=s(null),te=s([]),R=s(null),F=s(null),H=s(0),A=s(0),_e=o=>{ae.value=!0,setTimeout(async()=>{try{const t=await j("sales/search_product?search="+(G.value?G.value:""),{method:"GET",onResponseError({response:d}){console.log(d._data.error)}});te.value=t.products.data,ae.value=!1}catch(t){console.log(t)}},500)};ee(G,o=>{if(R.value=null,!S.value){setTimeout(()=>{R.value="Es necesario seleccionar un almacÃ©n antes de escoger un producto"},25);return}(o||"").length>3?_e():te.value=[]}),ee(L,o=>{}),ee(S,o=>{}),ee(F,o=>{});const fe=async()=>{if(R.value=null,!L.value){setTimeout(()=>{R.value="Es necesario seleccionar un producto"},25);return}if(!F.value){setTimeout(()=>{R.value="Es necesario seleccionar una unidad"},25);return}if(!H.value){setTimeout(()=>{R.value="Es necesario indicar un precio unitario"},25);return}if(!A.value||A.value<0){setTimeout(()=>{R.value="Es necesario indicar una cantidad"},25);return}let o=p.value.find(d=>d.id==F.value),t={purchase_id:T.params.id,product:L.value,unit_id:F.value,unit:o,price_unit:H.value,quantity:A.value,total:Number((H.value*A.value).toFixed(2))};try{const d=await j("purchase_details/",{method:"POST",body:t,onResponseError({response:q}){w.value=q._data.error}});U.value.push(d.purchase_detail),B.value=d.importe,k.value=d.total,z.value=d.igv,setTimeout(()=>{F.value="",H.value=0,A.value=0,L.value=null,G.value=""},25)}catch(d){console.log(d)}},be=o=>{C.value=!0,y.value=o},he=o=>{const t=o.purchase_detail;let d=U.value.findIndex(q=>q.id==t.id);d!=-1&&(U.value[d]=t),B.value=o.importe,z.value=o.igv,k.value=o.total},Ve=async o=>{try{let t={purchase_id:T.params.id,purchase_detail_id:o.id};const d=await j("purchase_details/attention",{method:"POST",body:t,onResponseError({response:Q}){w.value=Q._data.error}});let q=U.value.findIndex(Q=>Q.id==d.purchase_detail.id);q!=-1&&(U.value[q]=d.purchase_detail)}catch(t){console.log(t)}},ge=(o,t)=>{v.value=!0,h.value=o},De=o=>{let t=U.value.findIndex(d=>d.id==o.purchase_detail_id);t!=-1&&U.value.splice(t,1),B.value=o.importe,z.value=o.igv,k.value=o.total},ye=async()=>{try{if(w.value=null,Z.value=null,!S.value){setTimeout(()=>{w.value="Es requerido seleccionar un almacÃ©n"},25);return}if(!x.value){setTimeout(()=>{w.value="Es requerido seleccionar un proveedor"},25);return}if(!V.value){setTimeout(()=>{w.value="Es requerido seleccionar un tipo de comprobante"},25);return}if(!c.value){setTimeout(()=>{w.value="Es requerido indicar un n.Âº de comprobante"},25);return}if(U.value==0){setTimeout(()=>{w.value="Es requerido aÃ±adir al menos un producto al detalle"},25);return}let o={provider_id:x.value,type_comprobant:V.value,n_comprobant:c.value,description:N.value};const t=await j("purchase/"+T.params.id,{method:"PATCH",body:o,onResponseError({response:d}){w.value=d._data.error}});Z.value="La compra se ha actualizado correctamente"}catch(o){console.log(o)}},Ee=async()=>{try{const o=await j("purchase/config",{method:"GET",onResponseError({response:t}){console.log(t._data.error)}});X.value=o.warehouses,p.value=o.units,P.value=o.providers}catch(o){console.log(o)}},xe=async()=>{try{const o=await j("purchase/"+T.params.id,{method:"GET",onResponseError({response:t}){console.log(t._data.error)}});S.value=o.purchase.warehouse_id,x.value=o.purchase.provider_id,E.value=o.purchase.date_emision,V.value=o.purchase.type_comprobant,c.value=o.purchase.n_comprobant,N.value=o.purchase.description,U.value=o.purchase.details,B.value=o.purchase.importe,z.value=o.purchase.igv,k.value=o.purchase.total}catch(o){console.log(o)}};return se(()=>{Ee(),xe()}),(o,t)=>{const d=Pe,q=ke,Q=Be,Ce=qe;return m(),oe("div",null,[i("div",Fe,[i("div",Ae,[i("h4",je," ðŸ—ƒï¸ Editar compra: #"+_(a(T).params.id),1),ze])]),e(O,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(W,{class:"mb-6",title:"InformaciÃ³n general"},{default:l(()=>[e(le,null,{default:l(()=>[e(O,null,{default:l(()=>[e(r,{cols:"3"},{default:l(()=>[e(I,{label:"Solicitante",placeholder:"",disabled:"",modelValue:a(n).full_name,"onUpdate:modelValue":t[0]||(t[0]=u=>a(n).full_name=u)},null,8,["modelValue"])]),_:1}),e(r,{cols:"3"},{default:l(()=>[e(I,{label:"Sucursal",placeholder:"",disabled:"",modelValue:a(n).sucursale.name,"onUpdate:modelValue":t[1]||(t[1]=u=>a(n).sucursale.name=u)},null,8,["modelValue"])]),_:1}),e(r,{cols:"3"},{default:l(()=>[e(K,{modelValue:a(S),"onUpdate:modelValue":t[2]||(t[2]=u=>f(S)?S.value=u:null),items:a(X),label:"Almacenes",placeholder:"Seleccionar almacÃ©n","item-title":"name","item-value":"id",eager:"",disabled:""},null,8,["modelValue","items"])]),_:1}),e(r,{cols:"3"},{default:l(()=>[e(K,{modelValue:a(x),"onUpdate:modelValue":t[3]||(t[3]=u=>f(x)?x.value=u:null),items:a(P),label:"Proveedores",placeholder:"Seleccionar proveedor","item-title":"full_name","item-value":"id",eager:""},null,8,["modelValue","items"])]),_:1})]),_:1}),e(O,null,{default:l(()=>[e(r,{cols:"3"},{default:l(()=>[e(d,{label:"Fecha de emisiÃ³n",placeholder:"Selecciona fecha",modelValue:a(E),"onUpdate:modelValue":t[4]||(t[4]=u=>f(E)?E.value=u:null),disabled:""},null,8,["modelValue"])]),_:1}),e(r,{cols:"3"},{default:l(()=>[e(K,{items:["FACTURA ELECTRÃ“NICA","NOTA DE CRÃ‰DITO","NOTA DE DÃ‰BITO","RECIBO POR HONORARIOS","GUÃA DE REMISIÃ“N"],modelValue:a(V),"onUpdate:modelValue":t[5]||(t[5]=u=>f(V)?V.value=u:null),label:"Tipo de comprobante",placeholder:"Seleccionar tipo",eager:""},null,8,["modelValue"])]),_:1}),e(r,{cols:"3"},{default:l(()=>[e(I,{modelValue:a(c),"onUpdate:modelValue":t[6]||(t[6]=u=>f(c)?c.value=u:null),label:"N.Âº de comprobante",placeholder:""},null,8,["modelValue"])]),_:1}),e(r,{cols:"3"},{default:l(()=>[e(ve,{label:"Nota final",placeholder:"",modelValue:a(N),"onUpdate:modelValue":t[7]||(t[7]=u=>f(N)?N.value=u:null)},null,8,["modelValue"])]),_:1}),a(w)?(m(),b(r,{key:0,cols:"12"},{default:l(()=>[e($,{closable:"","close-label":"Cerrar",color:"warning"},{default:l(()=>[g(_(a(w)),1)]),_:1})]),_:1})):D("",!0),a(Z)?(m(),b(r,{key:1,cols:"12"},{default:l(()=>[e($,{closable:"","close-label":"Cerrar",color:"success"},{default:l(()=>[g(_(a(Z)),1)]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(r,{cols:"12"},{default:l(()=>[e(W,{class:"mb-6",title:"Producto solicitado"},{default:l(()=>[e(le,null,{default:l(()=>[e(O,null,{default:l(()=>[e(r,{cols:"7"},{default:l(()=>[e(O,null,{default:l(()=>[e(r,{cols:"12"},{default:l(()=>[e(Ue,{modelValue:a(L),"onUpdate:modelValue":t[8]||(t[8]=u=>f(L)?L.value=u:null),search:a(G),"onUpdate:search":t[9]||(t[9]=u=>f(G)?G.value=u:null),loading:a(ae),items:a(te),"item-title":"title","item-value":"id","return-object":"",placeholder:"Buscar producto",label:"Â¿QuÃ© agregamos?",variant:"underlined","menu-props":{maxHeight:"200px"}},null,8,["modelValue","search","loading","items"])]),_:1}),a(R)?(m(),b(r,{key:0,cols:"12"},{default:l(()=>[e($,{closable:"","close-label":"Cerrar",color:"warning"},{default:l(()=>[g(_(a(R)),1)]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1}),e(r,{cols:"5"},{default:l(()=>[e(O,null,{default:l(()=>[e(r,{cols:"10"},{default:l(()=>[e(O,null,{default:l(()=>[e(r,{cols:"4"},{default:l(()=>[e(K,{items:a(p),"item-title":"name","item-value":"id",placeholder:"Seleccionar",modelValue:a(F),"onUpdate:modelValue":t[10]||(t[10]=u=>f(F)?F.value=u:null),label:"Unidades"},null,8,["items","modelValue"])]),_:1}),e(r,{cols:"4"},{default:l(()=>[e(I,{label:"Precio",type:"number",modelValue:a(H),"onUpdate:modelValue":t[11]||(t[11]=u=>f(H)?H.value=u:null),placeholder:""},null,8,["modelValue"])]),_:1}),e(r,{cols:"4"},{default:l(()=>[e(I,{label:"Cantidad",type:"number",modelValue:a(A),"onUpdate:modelValue":t[12]||(t[12]=u=>f(A)?A.value=u:null),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{cols:"2"},{default:l(()=>[e(M,{color:"primary",onClick:t[13]||(t[13]=u=>fe())},{default:l(()=>[e(ue,{icon:"ri-add-circle-line"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(r,{cols:"12"},{default:l(()=>[e(W,{class:"mb-6",title:"Detalle de la compra"},{default:l(()=>[e(Ie,null,{default:l(()=>[Ge,i("tbody",null,[(m(!0),oe(we,null,Te(a(U),(u,re)=>(m(),oe("tr",{key:re},[i("td",null,[u.state==1?(m(),b(M,{key:0,onClick:ie=>Ve(u),icon:"ri-contract-line",variant:"text"},null,8,["onClick"])):D("",!0)]),i("td",null,[u.state==1?(m(),b(ne,{key:0,color:"error"},{default:l(()=>[g(" Pendiente ")]),_:1})):D("",!0),u.state==2?(m(),b(ne,{key:1,color:"primary"},{default:l(()=>[g(" Entregado ")]),_:1})):D("",!0)]),i("td",null,_(u.product.title),1),i("td",null,_(u.unit.name),1),i("td",null,_(J(u.price_unit)),1),i("td",null,_(u.quantity),1),i("td",null,_(J(u.total)),1),i("td",Le,[e(q,{size:"small",onClick:ie=>be(u)},{default:l(()=>[e(ue,{icon:"ri-pencil-line"})]),_:2},1032,["onClick"]),u.state!=2?(m(),b(q,{key:0,size:"small",onClick:ie=>ge(u,re)},{default:l(()=>[e(ue,{icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])):D("",!0)])]))),128)),i("tr",null,[He,Me,i("td",null,[e(I,{label:"Importe","model-value":J(a(B)),readonly:""},null,8,["model-value"])]),i("td",null,[e(I,{label:"IVA","model-value":J(a(z)),readonly:""},null,8,["model-value"])]),i("td",null,[e(I,{label:"Total","model-value":J(a(k)),readonly:""},null,8,["model-value"])]),Xe])])]),_:1})]),_:1})]),_:1}),e(r,{cols:"12"},{default:l(()=>[e(M,{block:"",onClick:ye},{default:l(()=>[g(" Editar la compra ")]),_:1})]),_:1})]),_:1}),a(y)&&a(C)?(m(),b(Q,{key:0,isDialogVisible:a(C),"onUpdate:isDialogVisible":t[14]||(t[14]=u=>f(C)?C.value=u:null),purchaseDetailSelected:a(y),units:a(p),purchase_id:a(T).params.id,onEditPurchaseDetail:he},null,8,["isDialogVisible","purchaseDetailSelected","units","purchase_id"])):D("",!0),a(h)&&a(v)?(m(),b(Ce,{key:1,isDialogVisible:a(v),"onUpdate:isDialogVisible":t[15]||(t[15]=u=>f(v)?v.value=u:null),purchaseDetailSelected:a(h),onDeletePurchaseDetail:De},null,8,["isDialogVisible","purchaseDetailSelected"])):D("",!0)])}}};export{El as default};
