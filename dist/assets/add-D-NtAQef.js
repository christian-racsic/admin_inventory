import{_ as ae}from"./IconBtn-BnO4JjSS.js";import{_ as te}from"./AppDateTimePicker-BFxRjtXb.js";import{$ as B}from"./api-DxrbhZSf.js";import{a as r,V as E}from"./VRow-f7OHVuKd.js";import{V as O}from"./VCard-CrSgQsdG.js";import{V as J}from"./VCardText-D-w9kZpv.js";import{V as x}from"./VTextField-DIHLaahk.js";import{V as $}from"./VSelect-CLTqdzaG.js";import{V as ue}from"./VTextarea-DO_zl4Eg.js";import{V as j}from"./VAlert-ELbKA5bW.js";import{V as oe}from"./VAutocomplete-CwHZXTr4.js";import{r as s,x as I,o as ne,h as G,a as S,d as o,b as e,w as a,u,i as d,c as L,f as H,g as q,t as b,V as Q,l as K,F as re,j as se}from"./index-W4kja-31.js";import{V as de}from"./VTable-Cddsam7K.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./index-BYrzgnBV.js";/* empty css              */import"./VAvatar-D-KF6a6N.js";import"./VImg-BXz4PYAy.js";import"./forwardRefs-DWGaNmQL.js";import"./VList-DFWg69W8.js";import"./VDivider-D7rU52Ox.js";import"./VOverlay-DsWRzxlS.js";import"./VMenu-HxKMt7sI.js";import"./VCheckboxBtn-D15mcKdF.js";import"./VChip-6YKG-Q6j.js";import"./filter-CbKp_48J.js";const ie=o("div",{class:"d-flex flex-wrap justify-space-between gap-4 mb-6"},[o("div",{class:"d-flex flex-column justify-center"},[o("h4",{class:"text-h4 mb-1"}," ðŸšš AÃ±adir Nuevo Transporte "),o("p",{class:"text-body-1 mb-0"})])],-1),ce=o("thead",null,[o("tr",null,[o("th",{class:"text-uppercase"}," Producto "),o("th",{class:"text-uppercase"}," Unidad "),o("th",{class:"text-uppercase"}," Precio Unitario "),o("th",{class:"text-uppercase"}," Cantidad "),o("th",{class:"text-uppercase"}," Total "),o("th",{class:"text-uppercase"}," AcciÃ³n ")])],-1),me=o("td",null,null,-1),pe=o("td",null,null,-1),ve=o("td",null,null,-1),Le={__name:"add",setup(fe){const N=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null,i=s(null),m=s(null),A=s(null),U=s(null),v=s(0),g=s(0),w=s(0),k=s([]),D=s([]),T=s([]),f=s(null),R=s(null),F=s(!1),h=s(),p=s(null),P=s([]),c=s(null),V=s(null),y=s(0),_=s(0),W=n=>{F.value=!0,setTimeout(async()=>{try{const l=await B("sales/search_product?search="+(h.value?h.value:""),{method:"GET",onResponseError({response:C}){console.log(C._data.error)}});P.value=l.products.data,F.value=!1}catch(l){console.log(l)}},500)};I(h,n=>{if(c.value=null,!i.value){setTimeout(()=>{c.value="En necesario seleccionar un almacÃ©n de atenciÃ³n , antes de escoger un producto"},25);return}if(!m.value){setTimeout(()=>{c.value="En necesario seleccionar un almacÃ©n de entrega , antes de escoger un producto"},25);return}if(i.value==m.value){setTimeout(()=>{c.value="En necesario seleccionar almacenes diferentes , antes de escoger un producto"},25);return}n.length>3?W():P.value=[]}),I(p,n=>{n&&(k.value=n.warehouses.filter(l=>l.warehouse_id==i.value).map(l=>({id:l.unit_id,name:l.unit.name})))}),I(i,n=>{p.value&&(k.value=p.value.warehouses.filter(l=>l.warehouse_id==n).map(l=>({id:l.unit_id,name:l.unit.name})))}),I(V,n=>{console.log(n)});const X=()=>{if(c.value=null,!p.value){setTimeout(()=>{c.value="Es necesario seleccionar un producto"},25);return}if(!V.value){setTimeout(()=>{c.value="Es necesario seleccionar una unidad"},25);return}if(!y.value){setTimeout(()=>{c.value="Es necesario digitar un precio unitario para el producto"},25);return}if(!_.value||_.value<0){setTimeout(()=>{c.value="Es necesario digitar una cantidad"},25);return}let n=k.value.find(l=>l.id==V.value);T.value.push({product:p.value,unit_id:V.value,unit:n,price_unit:y.value,quantity:_.value,total:Number((y.value*_.value).toFixed(2))}),setTimeout(()=>{M(),V.value="",y.value=0,_.value=0,p.value=null,h.value=""},25)},M=()=>{v.value=Number(T.value.reduce((n,l)=>n+l.total,0).toFixed(2)),g.value=Number((v.value*.18).toFixed(2)),w.value=Number((v.value+g.value).toFixed(2))},Y=n=>{T.value.splice(n,1),M()},Z=async()=>{try{if(f.value=null,R.value=null,!i.value){setTimeout(()=>{f.value="Es requerido seleccionar un almacÃ©n de atenciÃ³n"},25);return}if(!m.value){setTimeout(()=>{f.value="Es requerido seleccionar un almacÃ©n de entrega"},25);return}if(m.value==i.value){setTimeout(()=>{f.value="Es requerido seleccionar almacenes diferentes"},25);return}if(T.value==0){setTimeout(()=>{f.value="Es requerido aÃ±adir al menos un producto al detallado"},25);return}let n={warehouse_start_id:i.value,warehouse_end_id:m.value,date_emision:A.value,transport_details:T.value,description:U.value,total:w.value,importe:v.value,igv:g.value};const l=await B("transports",{method:"POST",body:n,onResponseError({response:C}){f.value=C._data.error}});R.value="LA SOLICITUD DE TRANSPORTE SE HA REGISTRADO CORRECTAMENTE",setTimeout(()=>{i.value="",m.value="",U.value="",T.value=[],w.value=0,v.value=0,g.value=0},25)}catch(n){console.log(n)}},ee=async()=>{try{const n=await B("transports/config",{method:"GET",onResponseError({response:l}){console.log(l._data.error)}});D.value=n.warehouses,A.value=n.today}catch(n){console.log(n)}};return ne(()=>{ee()}),(n,l)=>{const C=te,le=ae;return S(),G("div",null,[ie,e(E,null,{default:a(()=>[e(r,{cols:"12"},{default:a(()=>[e(O,{class:"mb-6",title:"InformaciÃ³n General"},{default:a(()=>[e(J,null,{default:a(()=>[e(E,null,{default:a(()=>[e(r,{cols:"3"},{default:a(()=>[e(x,{label:"Solicitante",placeholder:"",disabled:"",modelValue:u(N).full_name,"onUpdate:modelValue":l[0]||(l[0]=t=>u(N).full_name=t)},null,8,["modelValue"])]),_:1}),e(r,{cols:"3"},{default:a(()=>[e(x,{label:"Sucursal",placeholder:"",disabled:"",modelValue:u(N).sucursale.name,"onUpdate:modelValue":l[1]||(l[1]=t=>u(N).sucursale.name=t)},null,8,["modelValue"])]),_:1}),e(r,{cols:"3"},{default:a(()=>[e($,{modelValue:u(i),"onUpdate:modelValue":l[2]||(l[2]=t=>d(i)?i.value=t:null),items:u(D),label:"AlmacÃ©n de AtenciÃ³n",placeholder:"Select AlmacÃ©n","item-title":"name","item-value":"id",eager:""},null,8,["modelValue","items"])]),_:1}),e(r,{cols:"3"},{default:a(()=>[e($,{modelValue:u(m),"onUpdate:modelValue":l[3]||(l[3]=t=>d(m)?m.value=t:null),items:u(D),label:"AlmacÃ©n de Entrega",placeholder:"Selecciona AlmacÃ©n","item-title":"name","item-value":"id",eager:""},null,8,["modelValue","items"])]),_:1})]),_:1}),e(E,null,{default:a(()=>[e(r,{cols:"3"},{default:a(()=>[e(C,{label:"Fecha de emisiÃ³n",placeholder:"Selecciona fehca",modelValue:u(A),"onUpdate:modelValue":l[4]||(l[4]=t=>d(A)?A.value=t:null)},null,8,["modelValue"])]),_:1}),e(r,{cols:"3"},{default:a(()=>[e(ue,{label:"Nota final",placeholder:"",modelValue:u(U),"onUpdate:modelValue":l[5]||(l[5]=t=>d(U)?U.value=t:null)},null,8,["modelValue"])]),_:1}),u(f)?(S(),L(r,{key:0,cols:"12"},{default:a(()=>[e(j,{closable:"","close-label":"Close Alert",color:"warning"},{default:a(()=>[q(b(u(f)),1)]),_:1})]),_:1})):H("",!0),u(R)?(S(),L(r,{key:1,cols:"12"},{default:a(()=>[e(j,{closable:"","close-label":"Close Alert",color:"success"},{default:a(()=>[q(b(u(R)),1)]),_:1})]),_:1})):H("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(r,{cols:"12"},{default:a(()=>[e(O,{class:"mb-6",title:"Producto Solicitado"},{default:a(()=>[e(J,null,{default:a(()=>[e(E,null,{default:a(()=>[e(r,{cols:"7"},{default:a(()=>[e(E,null,{default:a(()=>[e(r,{cols:"12"},{default:a(()=>[e(oe,{modelValue:u(p),"onUpdate:modelValue":l[6]||(l[6]=t=>d(p)?p.value=t:null),search:u(h),"onUpdate:search":l[7]||(l[7]=t=>d(h)?h.value=t:null),loading:u(F),items:u(P),"item-title":"title","item-value":"id","return-object":"",placeholder:"Search for a product",label:"Â¿Que agregamos?",variant:"underlined","menu-props":{maxHeight:"200px"}},null,8,["modelValue","search","loading","items"])]),_:1}),u(c)?(S(),L(r,{key:0,cols:"12"},{default:a(()=>[e(j,{closable:"","close-label":"Close Alert",color:"warning"},{default:a(()=>[q(b(u(c)),1)]),_:1})]),_:1})):H("",!0)]),_:1})]),_:1}),e(r,{cols:"5"},{default:a(()=>[e(E,null,{default:a(()=>[e(r,{cols:"10"},{default:a(()=>[e(E,null,{default:a(()=>[e(r,{cols:"4"},{default:a(()=>[e($,{items:u(k),"item-title":"name","item-value":"id",placeholder:"Select",modelValue:u(V),"onUpdate:modelValue":l[8]||(l[8]=t=>d(V)?V.value=t:null),label:"Unidades"},null,8,["items","modelValue"])]),_:1}),e(r,{cols:"4"},{default:a(()=>[e(x,{label:"Precio",type:"number",modelValue:u(y),"onUpdate:modelValue":l[9]||(l[9]=t=>d(y)?y.value=t:null),placeholder:""},null,8,["modelValue"])]),_:1}),e(r,{cols:"4"},{default:a(()=>[e(x,{label:"Cantidad",type:"number",modelValue:u(_),"onUpdate:modelValue":l[10]||(l[10]=t=>d(_)?_.value=t:null),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{cols:"2"},{default:a(()=>[e(Q,{color:"primary",onClick:l[11]||(l[11]=t=>X())},{default:a(()=>[e(K,{icon:"ri-add-circle-line"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(r,{cols:"12"},{default:a(()=>[e(O,{class:"mb-6",title:"Detalle de la S. Transporte"},{default:a(()=>[e(de,null,{default:a(()=>[ce,o("tbody",null,[(S(!0),G(re,null,se(u(T),(t,z)=>(S(),G("tr",{key:z},[o("td",null,b(t.product.title),1),o("td",null,b(t.unit.name),1),o("td",null,"â‚¬ "+b(t.price_unit),1),o("td",null,b(t.quantity),1),o("td",null,"â‚¬ "+b(t.total),1),o("td",null,[e(le,{size:"small",onClick:Ve=>Y(t,z)},{default:a(()=>[e(K,{icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])])]))),128)),o("tr",null,[me,pe,o("td",null,[e(x,{label:"Importe",placeholder:"",type:"number",modelValue:u(v),"onUpdate:modelValue":l[12]||(l[12]=t=>d(v)?v.value=t:null)},null,8,["modelValue"])]),o("td",null,[e(x,{label:"IVA (21%)",placeholder:"",type:"number",modelValue:u(g),"onUpdate:modelValue":l[13]||(l[13]=t=>d(g)?g.value=t:null)},null,8,["modelValue"])]),o("td",null,[e(x,{label:"Total",placeholder:"",type:"number",modelValue:u(w),"onUpdate:modelValue":l[14]||(l[14]=t=>d(w)?w.value=t:null)},null,8,["modelValue"])]),ve])])]),_:1})]),_:1})]),_:1}),e(r,{cols:"12"},{default:a(()=>[e(Q,{block:"",onClick:Z},{default:a(()=>[q(" Registrar una S. Transporte ")]),_:1})]),_:1})]),_:1})])}}};export{Le as default};
